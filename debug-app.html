<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuduFisio AI - Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .error { color: red; background: #ffeeee; padding: 10px; margin: 10px 0; border: 1px solid #ffcccc; }
        .success { color: green; background: #eeffee; padding: 10px; margin: 10px 0; border: 1px solid #ccffcc; }
        .info { color: blue; background: #eeeeff; padding: 10px; margin: 10px 0; border: 1px solid #ccccff; }
        iframe { width: 100%; height: 600px; border: 1px solid #ccc; margin: 20px 0; }
        .logs { max-height: 300px; overflow-y: auto; background: #f5f5f5; padding: 10px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üîç DuduFisio AI - Debug Tool</h1>

    <div id="status">
        <div class="info">Verificando aplica√ß√£o...</div>
    </div>

    <h2>üìä Testes de Conectividade</h2>
    <div id="connectivity-tests">
        <div>üîÑ Executando testes...</div>
    </div>

    <h2>üñ•Ô∏è Aplica√ß√£o em iFrame</h2>
    <iframe id="app-frame" src="http://localhost:5173"></iframe>

    <h2>üìù Console Logs</h2>
    <div id="console-logs" class="logs"></div>

    <script>
        const statusDiv = document.getElementById('status');
        const connectivityDiv = document.getElementById('connectivity-tests');
        const logsDiv = document.getElementById('console-logs');

        // Capture console logs
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };

        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logEntry.style.color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        // Override console methods
        console.log = function(...args) {
            originalConsole.log.apply(console, arguments);
            addLog('log', args.join(' '));
        };

        console.error = function(...args) {
            originalConsole.error.apply(console, arguments);
            addLog('error', args.join(' '));
        };

        console.warn = function(...args) {
            originalConsole.warn.apply(console, arguments);
            addLog('warn', args.join(' '));
        };

        console.info = function(...args) {
            originalConsole.info.apply(console, arguments);
            addLog('info', args.join(' '));
        };

        // Test connectivity
        async function testConnectivity() {
            const tests = [
                {
                    name: 'Servidor Vite',
                    url: 'http://localhost:5173',
                    test: async (url) => {
                        const response = await fetch(url);
                        return response.ok;
                    }
                },
                {
                    name: 'Index.tsx',
                    url: 'http://localhost:5173/index.tsx',
                    test: async (url) => {
                        const response = await fetch(url);
                        return response.ok && response.headers.get('Content-Type').includes('javascript');
                    }
                },
                {
                    name: 'App.tsx',
                    url: 'http://localhost:5173/App.tsx',
                    test: async (url) => {
                        const response = await fetch(url);
                        return response.ok;
                    }
                }
            ];

            let allPassed = true;
            let results = '<h3>Resultados dos Testes:</h3>';

            for (const test of tests) {
                try {
                    const result = await test.test(test.url);
                    const status = result ? 'success' : 'error';
                    const icon = result ? '‚úÖ' : '‚ùå';
                    results += `<div class="${status}">${icon} ${test.name}: ${result ? 'OK' : 'FALHA'}</div>`;

                    if (!result) allPassed = false;
                } catch (error) {
                    results += `<div class="error">‚ùå ${test.name}: ERRO - ${error.message}</div>`;
                    allPassed = false;
                }
            }

            connectivityDiv.innerHTML = results;

            // Update main status
            if (allPassed) {
                statusDiv.innerHTML = '<div class="success">‚úÖ Todos os testes passaram - Aplica√ß√£o funcionando!</div>';
            } else {
                statusDiv.innerHTML = '<div class="error">‚ùå Alguns testes falharam - Verifique os logs</div>';
            }
        }

        // Check iframe load
        const iframe = document.getElementById('app-frame');
        iframe.onload = function() {
            addLog('info', 'iFrame carregado com sucesso');

            // Try to access iframe console
            try {
                const iframeWindow = iframe.contentWindow;
                if (iframeWindow) {
                    // Capture iframe errors
                    iframeWindow.addEventListener('error', function(event) {
                        addLog('error', `iFrame Error: ${event.error?.message || event.message}`);
                    });

                    iframeWindow.addEventListener('unhandledrejection', function(event) {
                        addLog('error', `iFrame Unhandled Promise: ${event.reason}`);
                    });
                }
            } catch (e) {
                addLog('warn', 'N√£o foi poss√≠vel acessar o console do iFrame (normal por CORS)');
            }
        };

        iframe.onerror = function() {
            addLog('error', 'Falha ao carregar iFrame');
        };

        // Global error handlers
        window.addEventListener('error', function(event) {
            addLog('error', `Window Error: ${event.error?.message || event.message}`);
        });

        window.addEventListener('unhandledrejection', function(event) {
            addLog('error', `Unhandled Promise: ${event.reason}`);
        });

        // Start tests
        setTimeout(testConnectivity, 1000);

        // Auto-refresh tests every 30 seconds
        setInterval(testConnectivity, 30000);

        addLog('info', 'Debug tool iniciado');
    </script>
</body>
</html>