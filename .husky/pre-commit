#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Executando verificaÃ§Ãµes prÃ©-commit..."

# 1. Verificar build
echo "ğŸ“¦ Verificando build..."
npm run build || {
    echo "âŒ Build falhou! Corrija os erros antes de fazer commit."
    exit 1
}

# 2. Verificar imports problemÃ¡ticos
echo "ğŸ”— Verificando imports..."
npm run check-imports || {
    echo "âŒ Imports problemÃ¡ticos encontrados! Corrija antes de fazer commit."
    exit 1
}

# 3. Verificar vulnerabilidades crÃ­ticas
echo "ğŸ›¡ï¸ Verificando vulnerabilidades crÃ­ticas..."
npm audit --audit-level=high --production || {
    echo "âš ï¸ Vulnerabilidades crÃ­ticas encontradas! Considere corrigir."
}

# 4. Executar linter (apenas warnings, nÃ£o bloqueia)
echo "ğŸ§¹ Verificando linting crÃ­tico..."
npm run lint --max-warnings=50 || {
    echo "âš ï¸ Muitos problemas de linting encontrados, mas nÃ£o bloqueando commit."
    echo "ğŸ’¡ Execute 'npm run lint:fix' quando possÃ­vel."
}

# 5. Verificar tipos TypeScript (apenas warning)
echo "ğŸ“ Verificando tipos TypeScript..."
npm run type-check || {
    echo "âš ï¸ Erros de tipo encontrados, mas nÃ£o bloqueando commit."
    echo "ğŸ’¡ Corrija os erros de tipo quando possÃ­vel."
}

echo "âœ… Todas as verificaÃ§Ãµes passaram! Commit permitido."
