#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Executando verificações pré-commit..."

# 1. Verificar build
echo "📦 Verificando build..."
npm run build || {
    echo "❌ Build falhou! Corrija os erros antes de fazer commit."
    exit 1
}

# 2. Verificar imports problemáticos
echo "🔗 Verificando imports..."
npm run check-imports || {
    echo "❌ Imports problemáticos encontrados! Corrija antes de fazer commit."
    exit 1
}

# 3. Verificar vulnerabilidades críticas
echo "🛡️ Verificando vulnerabilidades críticas..."
npm audit --audit-level=high --production || {
    echo "⚠️ Vulnerabilidades críticas encontradas! Considere corrigir."
}

# 4. Executar linter (apenas warnings, não bloqueia)
echo "🧹 Verificando linting crítico..."
npm run lint --max-warnings=50 || {
    echo "⚠️ Muitos problemas de linting encontrados, mas não bloqueando commit."
    echo "💡 Execute 'npm run lint:fix' quando possível."
}

# 5. Verificar tipos TypeScript (apenas warning)
echo "📝 Verificando tipos TypeScript..."
npm run type-check || {
    echo "⚠️ Erros de tipo encontrados, mas não bloqueando commit."
    echo "💡 Corrija os erros de tipo quando possível."
}

echo "✅ Todas as verificações passaram! Commit permitido."
