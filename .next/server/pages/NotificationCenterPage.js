"use strict";(()=>{var a={};a.id=1211,a.ids=[1211,3220],a.modules={8732:a=>{a.exports=require("react/jsx-runtime")},19119:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{E:()=>h});var e=c(8732),f=c(71253),g=a([f]);function h({className:a,...b}){return(0,e.jsx)("div",{className:(0,f.cn)("animate-pulse rounded-md bg-muted",a),...b})}f=(g.then?(await g)():g)[0],d()}catch(a){d(a)}})},22320:(a,b,c)=>{c.d(b,{Fq:()=>h,td:()=>i,z0:()=>g});var d=c(92273),e=c(40396);let f=a=>new Promise(b=>setTimeout(b,a)),g=async a=>{await f(300);let b=d.db.getTreatmentPlans().find(b=>b.patientId===a);if(b){let a=await h(b.id);return{...b,exercises:a}}},h=async a=>(await f(300),d.db.getExercisePrescriptions().filter(b=>b.treatmentPlanId===a)),i=async(a,b)=>{await f(400);let c=d.db.getTreatmentPlans(),g=c.findIndex(b=>b.patientId===a);if(g>-1){let a=c[g],f=(b.exercises||[]).map((b,c)=>({id:`ex_${Date.now()}_${c}`,treatmentPlanId:a.id,exerciseName:b.exerciseName,sets:b.sets,repetitions:b.repetitions,resistanceLevel:"A definir",progressionCriteria:"A definir"})),h={...a,treatmentGoals:b.treatmentGoals||a.treatmentGoals,exercises:f.length>0?f:a.exercises};return d.db.updateTreatmentPlan(h),d.db.setExercisePrescriptionsForPlan(a.id,f),e.g.emit("treatmentPlans:changed"),h}throw Error("Plano de tratamento n\xe3o encontrado para este paciente.")}},33032:(a,b,c)=>{c.d(b,{YU:()=>g,_z:()=>f,sL:()=>h});var d=c(90668);let e=a=>new Promise(b=>setTimeout(b,a)),f=async(a,b,c)=>{if("opt-in"!==a.whatsappConsent)return console.warn(`[WhatsApp SIM] Message blocked for ${a.name} due to opt-out status.`),{success:!1,fallbackInitiated:!1};let f={id:`wapp_${Date.now()}`,patientId:a.id,patientName:a.name,phone:a.phone,type:c,content:b,status:"sending",createdAt:new Date};return(await d.SX(f),await e(1500+1e3*Math.random()),.1>Math.random())?(await d.Y4(f.id,{status:"failed"}),console.log(`[SMS Fallback SIM] WhatsApp failed for ${a.name}. Initiating SMS fallback.`),{success:!1,fallbackInitiated:!0}):(await d.Y4(f.id,{status:"sent"}),await e(500),await d.Y4(f.id,{status:"delivered"}),console.log(`[WhatsApp SIM] Message sent to ${a.name}: "${b}"`),setTimeout(()=>{d.Y4(f.id,{status:"read"})},5e3+3e3*Math.random()),{success:!0,fallbackInitiated:!1})},g=async(a,b,c)=>{let d=a.startTime.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),e=`Lembrete FisioFlow: Sua consulta \xe9 hoje \xe0s ${d}. Por favor, chegue com alguns minutos de anteced\xeancia. At\xe9 j\xe1!`;return await f(b,e,"reminder")},h=async(a,b)=>{let c=`Ol\xe1, ${a.name.split(" ")[0]||a.name}! Seu fisioterapeuta enviou seu plano de exerc\xedcios. Acesse pelo portal ou veja o resumo:

${b}`;return await f(a,c,"hep")}},33873:a=>{a.exports=require("path")},40361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},42227:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(8732);c(82015);let e=({title:a,subtitle:b,children:c})=>(0,d.jsxs)("div",{className:"pb-8 md:flex md:items-center md:justify-between",children:[(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold leading-tight text-slate-900 tracking-tight",children:a}),(0,d.jsx)("p",{className:"mt-2 text-lg text-slate-600",children:b})]}),(0,d.jsx)("div",{className:"mt-4 flex md:mt-0 md:ml-4",children:c})]})},46060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},50802:a=>{a.exports=import("clsx")},53126:(a,b,c)=>{c.d(b,{E:()=>g});var d=c(82015),e=c(79501),f=c(28471);let g=a=>{let[b,c]=(0,d.useState)([]),[g,h]=(0,d.useState)(!0),{user:i}=(0,f.As)(),j=(0,d.useCallback)(async()=>{if(!a){h(!1),c([]);return}h(!0);try{await e.T4(i);let b=await e.Tr(a);c(b)}catch(a){console.error("Failed to fetch notifications:",a)}finally{h(!1)}},[a,i]);(0,d.useEffect)(()=>{j()},[j]);let k=(0,d.useCallback)(async b=>{a&&(c(a=>a.map(a=>a.id===b?{...a,isRead:!0}:a)),await e.aI(b,a))},[a]),l=(0,d.useCallback)(async()=>{a&&(c(a=>a.map(a=>({...a,isRead:!0}))),await e.X0(a))},[a]),m=(0,d.useMemo)(()=>b.filter(a=>!a.isRead).length,[b]);return{notifications:b,isLoading:g,unreadCount:m,markAsRead:k,markAllAsRead:l,refetch:j}}},54822:a=>{a.exports=require("react-router-dom")},56472:a=>{a.exports=require("@opentelemetry/api")},69785:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>s,default:()=>o,getServerSideProps:()=>r,getStaticPaths:()=>q,getStaticProps:()=>p,handler:()=>A,reportWebVitals:()=>t,routeModule:()=>z,unstable_getServerProps:()=>x,unstable_getServerSideProps:()=>y,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>v,unstable_getStaticProps:()=>u});var e=c(63885),f=c(80237),g=c(81413),h=c(3317),i=c.n(h),j=c(76195),k=c.n(j),l=c(72760),m=c(12289),n=a([l]);l=(n.then?(await n)():n)[0];let o=(0,g.M)(l,"default"),p=(0,g.M)(l,"getStaticProps"),q=(0,g.M)(l,"getStaticPaths"),r=(0,g.M)(l,"getServerSideProps"),s=(0,g.M)(l,"config"),t=(0,g.M)(l,"reportWebVitals"),u=(0,g.M)(l,"unstable_getStaticProps"),v=(0,g.M)(l,"unstable_getStaticPaths"),w=(0,g.M)(l,"unstable_getStaticParams"),x=(0,g.M)(l,"unstable_getServerProps"),y=(0,g.M)(l,"unstable_getServerSideProps"),z=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/NotificationCenterPage",pathname:"/NotificationCenterPage",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:k(),Document:i()},userland:l}),A=(0,m.U)({srcPage:"/NotificationCenterPage",config:s,userland:l,routeModule:z,getStaticPaths:q,getStaticProps:p,getServerSideProps:r});d()}catch(a){d(a)}})},71253:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{cn:()=>h});var e=c(50802),f=c(75979),g=a([e,f]);function h(...a){return(0,f.twMerge)((0,e.clsx)(a))}[e,f]=g.then?(await g)():g,d()}catch(a){d(a)}})},72760:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>r});var e=c(8732),f=c(82015),g=c(42227),h=c(28471),i=c(53126),j=c(72393),k=c(79501),l=c(99597),m=c(51302),n=c(19119),o=a([n]);n=(o.then?(await o)():o)[0];let p=({notification:a,onMarkAsRead:b})=>(0,e.jsxs)("div",{onClick:()=>!a.isRead&&b(a.id),className:`flex items-start p-4 border-b border-slate-200 transition-colors duration-200 ${!a.isRead?"bg-sky-50/50 hover:bg-sky-100 cursor-pointer":"bg-white"}`,children:[(0,e.jsxs)("div",{className:"flex-shrink-0 relative",children:[!a.isRead&&(0,e.jsx)("span",{className:"absolute -left-1 top-2 h-2 w-2 rounded-full bg-sky-500"}),(0,e.jsx)("div",{className:"p-2 bg-slate-100 rounded-full ml-2",children:(a=>{switch(a){case"task_assigned":return(0,e.jsx)(m.ZMX,{className:"w-5 h-5 text-purple-500"});case"announcement":return(0,e.jsx)(m.R03,{className:"w-5 h-5 text-amber-500"});case"appointment_reminder":return(0,e.jsx)(m.NFb,{className:"w-5 h-5 text-sky-500"});case"exercise_reminder":return(0,e.jsx)(m.O0M,{className:"w-5 h-5 text-teal-500"});default:return(0,e.jsx)(m.IrQ,{className:"w-5 h-5 text-slate-500"})}})(a.type)})]}),(0,e.jsxs)("div",{className:"ml-4 flex-grow",children:[(0,e.jsx)("p",{className:"text-sm text-slate-700",children:a.message}),(0,e.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:(a=>{let b=Math.floor((new Date().getTime()-a.getTime())/1e3);if(b<60)return"agora mesmo";let c=Math.floor(b/60);if(c<60)return`h\xe1 ${c} min`;let d=Math.floor(c/60);if(d<24)return`h\xe1 ${d}h`;let e=Math.floor(d/24);return`h\xe1 ${e}d`})(a.createdAt)})]})]}),q=({onSent:a})=>{let[b,c]=(0,f.useState)(""),[d,g]=(0,f.useState)(j.Xh.Therapist),[h,i]=(0,f.useState)(!1),{showToast:n}=(0,l.dj)(),o=async e=>{if(e.preventDefault(),!b.trim())return void n("A mensagem n\xe3o pode estar vazia.","error");i(!0);try{await k.eb(b,d),n("Comunicado enviado com sucesso!","success"),c(""),a()}catch(a){n("Falha ao enviar comunicado.","error")}finally{i(!1)}};return(0,e.jsxs)("form",{onSubmit:o,className:"p-6 space-y-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"broadcast-message",className:"block text-sm font-medium text-slate-700",children:"Mensagem"}),(0,e.jsx)("textarea",{id:"broadcast-message",rows:4,value:b,onChange:a=>c(a.target.value),className:"mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500",placeholder:"Digite seu comunicado aqui..."})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"target-group",className:"block text-sm font-medium text-slate-700",children:"Destinat\xe1rios"}),(0,e.jsxs)("select",{id:"target-group",value:d,onChange:a=>g(a.target.value),className:"mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500",children:[(0,e.jsx)("option",{value:j.Xh.Therapist,children:"Todos os Fisioterapeutas"}),(0,e.jsx)("option",{value:j.Xh.Patient,children:"Todos os Pacientes"}),(0,e.jsx)("option",{value:j.Xh.EducadorFisico,children:"Todos os Educadores F\xedsicos"})]})]}),(0,e.jsx)("div",{className:"text-right",children:(0,e.jsxs)("button",{type:"submit",disabled:h,className:"inline-flex items-center justify-center rounded-lg border border-transparent bg-teal-500 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-teal-600 disabled:bg-teal-300",children:[h?(0,e.jsx)(m.aHM,{className:"w-5 h-5 mr-2 animate-spin"}):(0,e.jsx)(m.Vnp,{className:"w-5 h-5 mr-2"}),h?"Enviando...":"Enviar Comunicado"]})})]})},r=()=>{let[a,b]=(0,f.useState)("my"),{user:c}=(0,h.As)(),{notifications:d,isLoading:k,unreadCount:l,markAsRead:o,markAllAsRead:r,refetch:s}=(0,i.E)(c?.id||"");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g.A,{title:"Centro de Notifica\xe7\xf5es",subtitle:"Acompanhe suas mensagens e envie comunicados para a equipe."}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[(0,e.jsx)("div",{className:"border-b border-slate-200",children:(0,e.jsxs)("nav",{className:"flex space-x-4 px-6","aria-label":"Tabs",children:[(0,e.jsxs)("button",{onClick:()=>b("my"),className:`flex items-center whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${"my"===a?"border-teal-500 text-teal-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[(0,e.jsx)(m.IrQ,{className:"w-5 h-5 mr-2"}),"Minhas Notifica\xe7\xf5es ",l>0&&(0,e.jsx)("span",{className:"ml-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center",children:l})]}),c?.role===j.Xh.Admin&&(0,e.jsxs)("button",{onClick:()=>b("broadcast"),className:`flex items-center whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${"broadcast"===a?"border-teal-500 text-teal-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[(0,e.jsx)(m.vEG,{className:"w-5 h-5 mr-2"}),"Enviar Comunicado"]})]})}),"my"===a&&(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"p-4 flex justify-end border-b border-slate-200",children:(0,e.jsxs)("button",{onClick:r,disabled:0===l,className:"inline-flex items-center text-sm font-medium text-teal-600 hover:text-teal-800 disabled:text-slate-400 disabled:cursor-not-allowed",children:[(0,e.jsx)(m.frJ,{className:"w-5 h-5 mr-2"}),"Marcar todas como lidas"]})}),k?Array.from({length:3}).map((a,b)=>(0,e.jsx)(n.E,{className:"h-20 w-full"},b)):d.length>0?(0,e.jsx)("div",{className:"divide-y divide-slate-200",children:d.map(a=>(0,e.jsx)(p,{notification:a,onMarkAsRead:o},a.id))}):(0,e.jsxs)("div",{className:"text-center p-12",children:[(0,e.jsx)(m.bOv,{className:"w-16 h-16 mx-auto text-slate-300 mb-4"}),(0,e.jsx)("h3",{className:"text-lg font-semibold text-slate-700",children:"Caixa de entrada vazia"}),(0,e.jsx)("p",{className:"text-slate-500 mt-1",children:"Voc\xea n\xe3o tem nenhuma notifica\xe7\xe3o no momento."})]})]}),"broadcast"===a&&c?.role===j.Xh.Admin&&(0,e.jsx)(q,{onSent:s})]})]})};d()}catch(a){d(a)}})},75979:a=>{a.exports=import("tailwind-merge")},79501:(a,b,c)=>{c.d(b,{T4:()=>j,Tr:()=>k,X0:()=>m,aI:()=>l,eb:()=>n});var d=c(72393),e=c(4183),f=c(22320),g=c(33032);let h=[...e.pG],i=a=>new Promise(b=>setTimeout(b,a)),j=async a=>{if(!a)return;let b=new Date().toDateString();if(a.role===d.Xh.Therapist||a.role===d.Xh.Admin){let c=`appointment_reminder_sent_${a.id}_${b}`;if(sessionStorage.getItem(c))return;let f=new Date,i=new Date(f);i.setDate(f.getDate()+1);let j=e.ZS.filter(b=>{let c=b.startTime;return b.therapistId===a.id&&(c.toDateString()===f.toDateString()||c.toDateString()===i.toDateString())&&b.status===d.y2.Scheduled});for(let c of(j.forEach(b=>{if(!h.some(c=>c.userId===a.id&&"appointment_reminder"===c.type&&c.message.includes(b.patientName)&&c.message.includes(b.startTime.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})))){let c=b.startTime.toDateString()===f.toDateString()?"hoje":"amanh\xe3",d={id:`notif_appt_${b.id}`,userId:a.id,message:`Lembrete: Consulta com ${b.patientName} ${c} \xe0s ${b.startTime.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}.`,isRead:!1,createdAt:new Date,type:"appointment_reminder"};h.unshift(d)}}),j.filter(a=>a.startTime.toDateString()===b&&a.startTime>f))){let a=e.N.find(a=>a.id===c.patientId);a&&await g.YU(c,a,0)}j.length>0&&sessionStorage.setItem(c,"true")}if(a.role===d.Xh.Patient&&a.patientId){let c=`exercise_reminder_sent_${a.id}_${b}`;if(sessionStorage.getItem(c))return;let d=await f.z0(a.patientId);if(d&&d.exercises&&d.exercises.length>0){let b={id:`notif_ex_${Date.now()}`,userId:a.id,message:"Lembrete di\xe1rio: N\xe3o se esque\xe7a de fazer seus exerc\xedcios de hoje para acelerar sua recupera\xe7\xe3o!",isRead:!1,createdAt:new Date,type:"exercise_reminder"};h.unshift(b),sessionStorage.setItem(c,"true")}}},k=async a=>(await i(300),[...h].filter(b=>b.userId===a).sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime())),l=async(a,b)=>{await i(100);let c=h.find(c=>c.id===a&&c.userId===b);return c&&(c.isRead=!0),c},m=async a=>{await i(200);let b=h.filter(b=>b.userId===a);return b.forEach(a=>a.isRead=!0),b},n=async(a,b)=>{await i(500),e.rB.filter(a=>a.role===b).forEach(b=>{let c={id:`notif_${Date.now()}_${b.id}`,userId:b.id,message:`Comunicado: ${a}`,isRead:!1,createdAt:new Date,type:"announcement"};h.unshift(c)})}},82015:a=>{a.exports=require("react")},90668:(a,b,c)=>{c.d(b,{SX:()=>h,Y4:()=>i,ao:()=>g});let d="fisioflow_whatsapp_log",e=()=>{let a=sessionStorage.getItem(d);return a?JSON.parse(a).map(a=>({...a,createdAt:new Date(a.createdAt)})):[]},f=a=>{sessionStorage.setItem(d,JSON.stringify(a))},g=async()=>(await new Promise(a=>setTimeout(a,300)),e().sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime())),h=async a=>{let b=e();b.unshift(a),f(b)},i=async(a,b)=>{let c=e(),d=c.findIndex(b=>b.id===a);if(d>-1){let a={...c[d],...b,createdAt:b.createdAt instanceof Date?b.createdAt:c[d].createdAt};c[d]=a,f(c)}}},93939:a=>{a.exports=require("@supabase/supabase-js")},99597:(a,b,c)=>{c.d(b,{dj:()=>g}),c(8732);var d=c(82015);c(54822);let e=(0,d.createContext)(void 0),f=(0,d.createContext)(void 0),g=()=>{let a=(()=>{let a=(0,d.useContext)(e);return void 0===a?{enabled:!1,logRouterChange:()=>{},logHookCall:()=>{},logContextAccess:()=>{}}:a})(),b=(0,d.useContext)(f);if(a.logContextAccess("ToastContext","useToast"),!b){let a=Error("useToast must be used within a ToastProvider");throw console.error("âŒ Toast Context Error:",a.message),a}return{showToast:b.showToast}}}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[3317,9871,1302,4183,7367,8471],()=>b(b.s=69785));module.exports=c})();