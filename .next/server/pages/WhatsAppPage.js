"use strict";(()=>{var a={};a.id=3015,a.ids=[3015,3220],a.modules={8732:a=>{a.exports=require("react/jsx-runtime")},15640:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>n});var e=c(8732),f=c(82015),g=c(42227),h=c(30871),i=c(90668),j=c(51302),k=c(19119),l=a([k]);k=(l.then?(await l)():l)[0];let m=({log:a})=>{let b={sending:{text:"Enviando",color:"bg-slate-100 text-slate-800",icon:(0,e.jsx)(j.aHM,{className:"w-3 h-3 animate-spin"})},sent:{text:"Enviado",color:"bg-sky-100 text-sky-800",icon:(0,e.jsx)(j.Jlk,{className:"w-3 h-3"})},delivered:{text:"Entregue",color:"bg-blue-100 text-blue-800",icon:(0,e.jsx)(j.frJ,{className:"w-3 h-3"})},read:{text:"Lido",color:"bg-green-100 text-green-800",icon:(0,e.jsx)(j.frJ,{className:"w-3 h-3 text-blue-500"})},failed:{text:"Falhou",color:"bg-red-100 text-red-800",icon:(0,e.jsx)(j.Jpz,{className:"w-3 h-3"})}}[a.status];return(0,e.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,e.jsxs)("td",{className:"p-3",children:[(0,e.jsx)("div",{className:"font-medium text-slate-800",children:a.patientName}),(0,e.jsx)("div",{className:"text-xs text-slate-500",children:a.phone})]}),(0,e.jsx)("td",{className:"p-3 text-sm text-slate-600 max-w-sm truncate",title:a.content,children:a.content}),(0,e.jsx)("td",{className:"p-3 text-sm text-slate-500 capitalize",children:a.type}),(0,e.jsx)("td",{className:"p-3 text-center",children:(0,e.jsxs)("span",{title:b.text,className:`px-2 py-1 inline-flex items-center text-xs leading-5 font-semibold rounded-full capitalize ${b.color}`,children:[b.icon,(0,e.jsx)("span",{className:"ml-1.5",children:b.text})]})}),(0,e.jsx)("td",{className:"p-3 text-xs text-slate-500 whitespace-nowrap",children:a.createdAt.toLocaleString("pt-BR")})]})},n=()=>{let[a,b]=(0,f.useState)("simulator"),[c,d]=(0,f.useState)([]),[l,n]=(0,f.useState)(!1);return(0,f.useEffect)(()=>{"log"===a&&(n(!0),i.ao().then(a=>{d(a),n(!1)}))},[a]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g.A,{title:"Integra\xe7\xe3o WhatsApp",subtitle:"Simule conversas e monitore o log de mensagens autom\xe1ticas."}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[(0,e.jsx)("div",{className:"border-b border-slate-200",children:(0,e.jsxs)("nav",{className:"flex space-x-4 px-6","aria-label":"Tabs",children:[(0,e.jsxs)("button",{onClick:()=>b("simulator"),className:`flex items-center whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${"simulator"===a?"border-teal-500 text-teal-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[(0,e.jsx)(j.cC5,{className:"w-5 h-5 mr-2"})," Simulador de Chat"]}),(0,e.jsxs)("button",{onClick:()=>b("log"),className:`flex items-center whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${"log"===a?"border-teal-500 text-teal-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[(0,e.jsx)(j.B8B,{className:"w-5 h-5 mr-2"})," Log de Mensagens"]})]})}),"simulator"===a&&(0,e.jsx)("div",{className:"p-4 md:p-6",children:(0,e.jsx)(h.A,{})}),"log"===a&&(0,e.jsx)("div",{className:"p-4 md:p-6",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-slate-200",children:[(0,e.jsx)("thead",{className:"bg-slate-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"p-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Paciente"}),(0,e.jsx)("th",{className:"p-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Conte\xfado"}),(0,e.jsx)("th",{className:"p-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Tipo"}),(0,e.jsx)("th",{className:"p-3 text-center text-xs font-medium text-slate-500 uppercase",children:"Status"}),(0,e.jsx)("th",{className:"p-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Data"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-slate-200",children:l?Array.from({length:3}).map((a,b)=>(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:5,className:"p-3",children:(0,e.jsx)(k.E,{className:"h-10 w-full"})})},b)):c.length>0?c.map(a=>(0,e.jsx)(m,{log:a},a.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:5,className:"text-center p-10 text-slate-500",children:"Nenhuma mensagem no log. Confirma\xe7\xf5es e lembretes aparecer\xe3o aqui."})})})]})})})]})]})};d()}catch(a){d(a)}})},19119:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{E:()=>h});var e=c(8732),f=c(71253),g=a([f]);function h({className:a,...b}){return(0,e.jsx)("div",{className:(0,f.cn)("animate-pulse rounded-md bg-muted",a),...b})}f=(g.then?(await g)():g)[0],d()}catch(a){d(a)}})},22320:(a,b,c)=>{c.d(b,{Fq:()=>h,td:()=>i,z0:()=>g});var d=c(92273),e=c(40396);let f=a=>new Promise(b=>setTimeout(b,a)),g=async a=>{await f(300);let b=d.db.getTreatmentPlans().find(b=>b.patientId===a);if(b){let a=await h(b.id);return{...b,exercises:a}}},h=async a=>(await f(300),d.db.getExercisePrescriptions().filter(b=>b.treatmentPlanId===a)),i=async(a,b)=>{await f(400);let c=d.db.getTreatmentPlans(),g=c.findIndex(b=>b.patientId===a);if(g>-1){let a=c[g],f=(b.exercises||[]).map((b,c)=>({id:`ex_${Date.now()}_${c}`,treatmentPlanId:a.id,exerciseName:b.exerciseName,sets:b.sets,repetitions:b.repetitions,resistanceLevel:"A definir",progressionCriteria:"A definir"})),h={...a,treatmentGoals:b.treatmentGoals||a.treatmentGoals,exercises:f.length>0?f:a.exercises};return d.db.updateTreatmentPlan(h),d.db.setExercisePrescriptionsForPlan(a.id,f),e.g.emit("treatmentPlans:changed"),h}throw Error("Plano de tratamento n\xe3o encontrado para este paciente.")}},30871:(a,b,c)=>{c.d(b,{A:()=>j});var d=c(8732),e=c(82015),f=c(51302),g=c(28471),h=c(22320),i=c(33032);let j=()=>{let[a,b]=(0,e.useState)([]),[c,j]=(0,e.useState)(""),[k,l]=(0,e.useState)(!1),[m,n]=(0,e.useState)("initial"),o=(0,e.useRef)(null),{user:p}=(0,g.As)(),q={...p?.id&&{id:p.id},...p?.name&&{name:p.name},whatsappConsent:"opt-in"};(0,e.useEffect)(()=>{b([{id:Date.now(),text:`Ol\xe1, ${q.name}! ðŸ‘‹ Sou o assistente virtual da FisioFlow. Como posso ajudar?

*1* - Ver meus exerc\xedcios de hoje
*2* - Agendar uma nova consulta
*3* - Falar com um atendente`,sender:"bot"}])},[q.name]),(0,e.useEffect)(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[a,k]);let r=a=>{l(!0),setTimeout(()=>{let c={id:Date.now(),text:a,sender:"bot"};b(a=>[...a,c]),l(!1)},1e3+500*Math.random())},s=async a=>{let c={id:Date.now(),text:a,sender:"user"};if(b(a=>[...a,c]),j(""),q.id&&q.name&&q.phone&&i._z(q,a,"chat"),"initial"===m)if("1"===a.trim()){let a=await h.z0("1");if(a&&a.exercises){let b=a.exercises.map(a=>` - ${a.exerciseName} (${a.sets}x${a.repetitions})`).join("\n");r(`Claro! Seus exerc\xedcios para hoje s\xe3o:
${b}

Lembre-se de marcar como feito no seu portal! ðŸ˜‰`)}else r("Voc\xea n\xe3o tem um plano de exerc\xedcios ativo no momento.")}else"2"===a.trim()?(r("Para agendar, preciso saber o melhor dia e per\xedodo para voc\xea. Por exemplo: 'ter\xe7a de manh\xe3' ou 'sexta \xe0 tarde'."),n("scheduling_day")):"3"===a.trim()?(r("Ok! Um de nossos atendentes entrar\xe1 em contato com voc\xea por aqui em breve. Por favor, aguarde."),n("waiting_human")):r("Desculpe, n\xe3o entendi. Por favor, escolha uma das op\xe7\xf5es (1, 2 ou 3).");else"scheduling_day"===m?(r(`Perfeito! Verificando hor\xe1rios para *${a}*... Encontrei uma vaga \xe0s 10:00. Deseja confirmar? (Sim/N\xe3o)`),n("scheduling_confirm")):"scheduling_confirm"===m?(a.toLowerCase().includes("sim")?r("\xd3timo! Sua consulta foi agendada. Voc\xea receber\xe1 uma confirma\xe7\xe3o com todos os detalhes. At\xe9 breve!"):r("Entendido. Se quiser tentar outra data, \xe9 s\xf3 me dizer."),n("initial")):"waiting_human"===m&&r("Nossos atendentes ainda est\xe3o ocupados. Assim que um estiver dispon\xedvel, ele responder\xe1 aqui. Obrigado pela paci\xeancia!")};return(0,d.jsxs)("div",{className:"flex justify-center",children:[(0,d.jsxs)("div",{className:"w-full max-w-lg mx-auto bg-white border border-slate-200 rounded-2xl shadow-lg flex flex-col",children:[(0,d.jsxs)("div",{className:"p-3 bg-slate-100 rounded-t-2xl flex items-center border-b",children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("img",{src:"https://i.pravatar.cc/150?u=clinic_logo",alt:"FisioFlow",className:"w-10 h-10 rounded-full"}),(0,d.jsx)("span",{className:"absolute bottom-0 right-0 block h-2.5 w-2.5 rounded-full bg-green-400 ring-2 ring-white"})]}),(0,d.jsxs)("div",{className:"ml-3",children:[(0,d.jsx)("p",{className:"font-semibold text-slate-800",children:"FisioFlow"}),(0,d.jsx)("p",{className:"text-xs text-slate-500",children:"online"})]})]}),(0,d.jsx)("div",{className:"flex-1 p-4 h-96 overflow-y-auto bg-slate-50",children:(0,d.jsxs)("div",{className:"space-y-4",children:[a.map(a=>(0,d.jsxs)("div",{className:`flex items-end gap-2 ${"user"===a.sender?"justify-end":"justify-start"}`,children:["bot"===a.sender&&(0,d.jsx)(f.cC5,{className:"w-6 h-6 text-slate-400 self-start shrink-0"}),(0,d.jsx)("div",{className:`max-w-xs md:max-w-sm px-4 py-2 rounded-2xl ${"user"===a.sender?"bg-teal-500 text-white rounded-br-none":"bg-white text-slate-800 rounded-bl-none shadow-sm"}`,children:(0,d.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:a.text})})]},a.id)),k&&(0,d.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,d.jsx)(f.cC5,{className:"w-6 h-6 text-slate-400 self-start shrink-0"}),(0,d.jsxs)("div",{className:"bg-white text-slate-800 rounded-2xl rounded-bl-none shadow-sm px-4 py-3 flex items-center",children:[(0,d.jsx)("span",{className:"typing-dot"}),(0,d.jsx)("span",{className:"typing-dot"}),(0,d.jsx)("span",{className:"typing-dot"})]})]}),(0,d.jsx)("div",{ref:o})]})}),(0,d.jsx)("div",{className:"p-3 bg-slate-100 rounded-b-2xl border-t",children:(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("input",{type:"text",value:c,onChange:a=>j(a.target.value),onKeyPress:a=>"Enter"===a.key&&c.trim()&&s(c),placeholder:"Digite sua mensagem...",className:"flex-1 w-full px-4 py-2 bg-white border border-slate-300 rounded-full focus:outline-none focus:ring-2 focus:ring-teal-500"}),(0,d.jsx)("button",{onClick:()=>c.trim()&&s(c),disabled:!c.trim(),className:"p-3 bg-teal-500 text-white rounded-full hover:bg-teal-600 disabled:bg-teal-300 transition-colors",children:(0,d.jsx)(f.Vnp,{className:"w-5 h-5"})})]})})]}),(0,d.jsx)("style",{children:`
                .typing-dot {
                    width: 6px; height: 6px; background-color: #94a3b8; border-radius: 50%; display: inline-block; margin: 0 2px;
                    animation: typing-animation 1.4s infinite ease-in-out both;
                }
                .typing-dot:nth-child(2) { animation-delay: .2s; }
                .typing-dot:nth-child(3) { animation-delay: .4s; }
                @keyframes typing-animation {
                    0%, 80%, 100% { transform: scale(0); }
                    40% { transform: scale(1.0); }
                }
            `})]})}},33032:(a,b,c)=>{c.d(b,{YU:()=>g,_z:()=>f,sL:()=>h});var d=c(90668);let e=a=>new Promise(b=>setTimeout(b,a)),f=async(a,b,c)=>{if("opt-in"!==a.whatsappConsent)return console.warn(`[WhatsApp SIM] Message blocked for ${a.name} due to opt-out status.`),{success:!1,fallbackInitiated:!1};let f={id:`wapp_${Date.now()}`,patientId:a.id,patientName:a.name,phone:a.phone,type:c,content:b,status:"sending",createdAt:new Date};return(await d.SX(f),await e(1500+1e3*Math.random()),.1>Math.random())?(await d.Y4(f.id,{status:"failed"}),console.log(`[SMS Fallback SIM] WhatsApp failed for ${a.name}. Initiating SMS fallback.`),{success:!1,fallbackInitiated:!0}):(await d.Y4(f.id,{status:"sent"}),await e(500),await d.Y4(f.id,{status:"delivered"}),console.log(`[WhatsApp SIM] Message sent to ${a.name}: "${b}"`),setTimeout(()=>{d.Y4(f.id,{status:"read"})},5e3+3e3*Math.random()),{success:!0,fallbackInitiated:!1})},g=async(a,b,c)=>{let d=a.startTime.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),e=`Lembrete FisioFlow: Sua consulta \xe9 hoje \xe0s ${d}. Por favor, chegue com alguns minutos de anteced\xeancia. At\xe9 j\xe1!`;return await f(b,e,"reminder")},h=async(a,b)=>{let c=`Ol\xe1, ${a.name.split(" ")[0]||a.name}! Seu fisioterapeuta enviou seu plano de exerc\xedcios. Acesse pelo portal ou veja o resumo:

${b}`;return await f(a,c,"hep")}},33873:a=>{a.exports=require("path")},40361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},42227:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(8732);c(82015);let e=({title:a,subtitle:b,children:c})=>(0,d.jsxs)("div",{className:"pb-8 md:flex md:items-center md:justify-between",children:[(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold leading-tight text-slate-900 tracking-tight",children:a}),(0,d.jsx)("p",{className:"mt-2 text-lg text-slate-600",children:b})]}),(0,d.jsx)("div",{className:"mt-4 flex md:mt-0 md:ml-4",children:c})]})},46060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},50802:a=>{a.exports=import("clsx")},56472:a=>{a.exports=require("@opentelemetry/api")},58137:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>s,default:()=>o,getServerSideProps:()=>r,getStaticPaths:()=>q,getStaticProps:()=>p,handler:()=>A,reportWebVitals:()=>t,routeModule:()=>z,unstable_getServerProps:()=>x,unstable_getServerSideProps:()=>y,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>v,unstable_getStaticProps:()=>u});var e=c(63885),f=c(80237),g=c(81413),h=c(3317),i=c.n(h),j=c(76195),k=c.n(j),l=c(15640),m=c(12289),n=a([l]);l=(n.then?(await n)():n)[0];let o=(0,g.M)(l,"default"),p=(0,g.M)(l,"getStaticProps"),q=(0,g.M)(l,"getStaticPaths"),r=(0,g.M)(l,"getServerSideProps"),s=(0,g.M)(l,"config"),t=(0,g.M)(l,"reportWebVitals"),u=(0,g.M)(l,"unstable_getStaticProps"),v=(0,g.M)(l,"unstable_getStaticPaths"),w=(0,g.M)(l,"unstable_getStaticParams"),x=(0,g.M)(l,"unstable_getServerProps"),y=(0,g.M)(l,"unstable_getServerSideProps"),z=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/WhatsAppPage",pathname:"/WhatsAppPage",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:k(),Document:i()},userland:l}),A=(0,m.U)({srcPage:"/WhatsAppPage",config:s,userland:l,routeModule:z,getStaticPaths:q,getStaticProps:p,getServerSideProps:r});d()}catch(a){d(a)}})},71253:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{cn:()=>h});var e=c(50802),f=c(75979),g=a([e,f]);function h(...a){return(0,f.twMerge)((0,e.clsx)(a))}[e,f]=g.then?(await g)():g,d()}catch(a){d(a)}})},75979:a=>{a.exports=import("tailwind-merge")},82015:a=>{a.exports=require("react")},90668:(a,b,c)=>{c.d(b,{SX:()=>h,Y4:()=>i,ao:()=>g});let d="fisioflow_whatsapp_log",e=()=>{let a=sessionStorage.getItem(d);return a?JSON.parse(a).map(a=>({...a,createdAt:new Date(a.createdAt)})):[]},f=a=>{sessionStorage.setItem(d,JSON.stringify(a))},g=async()=>(await new Promise(a=>setTimeout(a,300)),e().sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime())),h=async a=>{let b=e();b.unshift(a),f(b)},i=async(a,b)=>{let c=e(),d=c.findIndex(b=>b.id===a);if(d>-1){let a={...c[d],...b,createdAt:b.createdAt instanceof Date?b.createdAt:c[d].createdAt};c[d]=a,f(c)}}},93939:a=>{a.exports=require("@supabase/supabase-js")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[3317,9871,1302,4183,7367,8471],()=>b(b.s=58137));module.exports=c})();