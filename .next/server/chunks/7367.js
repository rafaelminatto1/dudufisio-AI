"use strict";exports.id=7367,exports.ids=[7367],exports.modules={17367:(a,b,c)=>{c.d(b,{W6:()=>o}),c(8732);var d=c(82015),e=c(72393),f=c(93939);let g=(void 0).NEXT_PUBLIC_SUPABASE_URL,h=(void 0).NEXT_PUBLIC_SUPABASE_ANON_KEY,i=g&&h&&"your_anon_key_here"!==h&&g.includes("supabase.co");i||console.warn("⚠️ Supabase credentials not configured. Using development mode.");let j=i?g:"https://dummy.supabase.co",k=(0,f.createClient)(j,i?h:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1bW15Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2NDUxOTI4MDAsImV4cCI6MTk2MDc2ODgwMH0.dummy",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"x-application-name":"dudufisio-ai"}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}}),l=a=>(console.error("Supabase error:",a),a?.message?.includes("JWT"))?"Sess\xe3o expirada. Por favor, fa\xe7a login novamente.":a?.message?.includes("duplicate")?"Este registro j\xe1 existe.":a?.message?.includes("foreign key")?"Este registro est\xe1 sendo usado em outro lugar e n\xe3o pode ser removido.":a?.code==="23505"?"Registro duplicado encontrado.":a?.code==="PGRST116"?"Voc\xea n\xe3o tem permiss\xe3o para realizar esta a\xe7\xe3o.":a?.message||"Ocorreu um erro ao processar sua solicita\xe7\xe3o.";class m{constructor(){this.listeners=new Set,this.currentState={user:null,session:null,loading:!0},this.initializeAuth()}async initializeAuth(){try{console.log("\uD83D\uDD10 Initializing Supabase authentication...");let a=setTimeout(()=>{console.warn("⚠️ Auth initialization timeout, falling back to unauthenticated state"),this.updateState({user:null,session:null,loading:!1})},5e3);try{console.log("\uD83D\uDD0D Getting initial session...");let{data:{session:b},error:c}=await k.auth.getSession();if(c)throw console.warn("⚠️ Session error:",c.message),c;if(b?.user){console.log("✅ Found active session, mapping user...");let a=await this.mapSupabaseUserToUser(b.user);this.updateState({user:a,session:b,loading:!1}),console.log("\uD83C\uDF89 User authenticated:",a.email)}else console.log("ℹ️ No active session found"),this.updateState({user:null,session:null,loading:!1});clearTimeout(a),console.log("\uD83D\uDC42 Setting up auth state change listener..."),k.auth.onAuthStateChange(async(a,b)=>{console.log("\uD83D\uDD04 Auth state changed:",a);try{if("SIGNED_IN"===a&&b?.user){let a=await this.mapSupabaseUserToUser(b.user);this.updateState({user:a,session:b,loading:!1})}else if("SIGNED_OUT"===a)this.updateState({user:null,session:null,loading:!1});else if("TOKEN_REFRESHED"===a&&b?.user){let a=await this.mapSupabaseUserToUser(b.user);this.updateState({user:a,session:b,loading:!1})}}catch(a){console.error("Error handling auth state change:",a)}}),console.log("✅ Auth initialization completed successfully")}catch(b){throw clearTimeout(a),b}}catch(a){console.error("❌ Auth initialization error:",a),console.log("\uD83D\uDD04 Falling back to unauthenticated state with mock auth support"),this.updateState({user:null,session:null,loading:!1})}}updateState(a){this.currentState={...this.currentState,...a},this.listeners.forEach(a=>a(this.currentState))}subscribe(a){return this.listeners.add(a),a(this.currentState),()=>{this.listeners.delete(a)}}getState(){return this.currentState}async login(a){try{if(this.shouldUseMockAuth(a))return this.mockLogin(a);let{data:b,error:c}=await k.auth.signInWithPassword({email:a.email,password:a.password});if(c)throw c;if(!b.user)throw Error("Login falhou");return await this.mapSupabaseUserToUser(b.user)}catch(b){if(this.shouldUseMockAuth(a))return this.mockLogin(a);throw Error(l(b))}}async register(a){try{let{data:b,error:c}=await k.auth.signUp({email:a.email,password:a.password,options:{data:{name:a.name,role:a.role,phone:a.phone}}});if(c)throw c;if(!b.user)throw Error("Registro falhou");let{error:d}=await k.from("user_profiles").insert({id:b.user.id,email:a.email,name:a.name,role:a.role,phone:a.phone,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});return d&&console.error("Profile creation error:",d),await this.mapSupabaseUserToUser(b.user)}catch(a){throw Error(l(a))}}async logout(){try{let{error:a}=await k.auth.signOut();if(a)throw a}catch(a){throw Error(l(a))}}async resetPassword(a){try{let{error:b}=await k.auth.resetPasswordForEmail(a,{redirectTo:`${window.location.origin}/reset-password`});if(b)throw b}catch(a){throw Error(l(a))}}async updatePassword(a){try{let{error:b}=await k.auth.updateUser({password:a});if(b)throw b}catch(a){throw Error(l(a))}}async updateProfile(a){try{let{data:{user:b},error:c}=await k.auth.updateUser({data:{name:a.name,phone:a.phone}});if(c)throw c;if(!b)throw Error("Usu\xe1rio n\xe3o encontrado");let{error:d}=await k.from("user_profiles").update({name:a.name,phone:a.phone,updated_at:new Date().toISOString()}).eq("id",b.id);if(d)throw d;return await this.mapSupabaseUserToUser(b)}catch(a){throw Error(l(a))}}async setup2FA(){try{let{data:a,error:b}=await k.auth.mfa.enroll({factorType:"totp"});if(b)throw b;return{secret:a.totp.secret,qrCode:a.totp.qr_code,backupCodes:[]}}catch(a){throw Error(l(a))}}async verify2FA(a,b){try{let{error:c}=await k.auth.mfa.challengeAndVerify({factorId:a,code:b});if(c)throw c}catch(a){throw Error(l(a))}}async get2FAFactors(){try{let{data:a,error:b}=await k.auth.mfa.listFactors();if(b)throw b;return a}catch(a){throw Error(l(a))}}async disable2FA(a){try{let{error:b}=await k.auth.mfa.unenroll({factorId:a});if(b)throw b}catch(a){throw Error(l(a))}}async getUserRole(a){try{let{data:b,error:c}=await k.from("user_profiles").select("role").eq("id",a).single();if(c)throw c;return b.role}catch(a){throw Error(l(a))}}async hasPermission(a){let b=this.currentState.user;if(!b)return!1;let c={[e.Xh.Admin]:["*"],[e.Xh.Therapist]:["patients:read","patients:write","appointments:read","appointments:write","treatments:read","treatments:write","reports:read","reports:write"],[e.Xh.Patient]:["profile:read","profile:write","appointments:read","exercises:read","progress:read"],[e.Xh.EducadorFisico]:["clients:read","clients:write","exercises:read","exercises:write","programs:read","programs:write"]}[b.role]||[];return c.includes("*")||c.includes(a)}async mapSupabaseUserToUser(a){try{let{data:b}=await k.from("user_profiles").select("*").eq("id",a.id).single();return{id:a.id,email:a.email||"",name:b?.name||a.user_metadata?.name||"Usu\xe1rio",role:b?.role||a.user_metadata?.role||e.Xh.Patient,phone:b?.phone||a.user_metadata?.phone||"",avatarUrl:b?.avatar_url||a.user_metadata?.avatar_url||"",emailVerified:!!a.email_confirmed_at,createdAt:a.created_at,lastSignIn:a.last_sign_in_at,mfaEnabled:a.factors&&a.factors.length>0}}catch(b){return console.error("Error mapping user:",b),{id:a.id,email:a.email||"",name:a.user_metadata?.name||"Usu\xe1rio",role:a.user_metadata?.role||e.Xh.Patient,phone:a.user_metadata?.phone||"",avatarUrl:a.user_metadata?.avatar_url||"",emailVerified:!!a.email_confirmed_at,createdAt:a.created_at,lastSignIn:a.last_sign_in_at,mfaEnabled:!1}}}async loginWithGoogle(){try{let{error:a}=await k.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/dashboard`}});if(a)throw a}catch(a){throw Error(l(a))}}async loginWithGitHub(){try{let{error:a}=await k.auth.signInWithOAuth({provider:"github",options:{redirectTo:`${window.location.origin}/dashboard`}});if(a)throw a}catch(a){throw Error(l(a))}}async refreshSession(){try{let{error:a}=await k.auth.refreshSession();if(a)throw a}catch(a){throw Error(l(a))}}isSessionExpired(){let a=this.currentState.session;return!a||new Date(1e3*a.expires_at)<=new Date}shouldUseMockAuth(a){let b=["admin@dudufisio.com","therapist@dudufisio.com","patient@dudufisio.com","educator@dudufisio.com"].includes(a.email)&&"demo123456"===a.password,c=!(void 0).VITE_SUPABASE_ANON_KEY||"your_anon_key_here"===(void 0).VITE_SUPABASE_ANON_KEY;return b||c}async mockLogin(a){await new Promise(a=>setTimeout(a,500));let b={"admin@dudufisio.com":{id:"user_admin",name:"Admin",email:"admin@dudufisio.com",role:"Admin",avatarUrl:"https://i.pravatar.cc/150?u=user_admin",phone:"(11) 98765-4321"},"therapist@dudufisio.com":{id:"user_1",name:"Dr. Roberto",email:"therapist@dudufisio.com",role:"Therapist",avatarUrl:"https://i.pravatar.cc/150?u=user_1",phone:"(11) 91234-5678"},"patient@dudufisio.com":{id:"user_patient_1",name:"Ana Beatriz Costa",email:"patient@dudufisio.com",role:"Patient",avatarUrl:"https://picsum.photos/id/1027/200/200",patientId:"1",phone:"(11) 98765-4321"},"educator@dudufisio.com":{id:"user_educator_1",name:"Dra. Juliana",email:"educator@dudufisio.com",role:"EducadorFisico",avatarUrl:"https://i.pravatar.cc/150?u=user_educator_1",phone:"(11) 91111-2222"}}[a.email];if(!b)throw Error("Credenciais inv\xe1lidas");let c={access_token:"mock_access_token",expires_at:Math.floor(Date.now()/1e3)+3600,user:{id:b.id,email:b.email}};return this.updateState({user:b,session:c,loading:!1}),console.log("\uD83C\uDFAD Mock authentication successful for:",b.email),b}}new m;let n=(0,d.createContext)(void 0),o=()=>{let a=(0,d.useContext)(n);if(void 0===a)throw Error("useSupabaseAuth must be used within a SupabaseAuthProvider");return a}}};