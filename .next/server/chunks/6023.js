"use strict";exports.id=6023,exports.ids=[6023],exports.modules={8926:(a,b,c)=>{c.d(b,{A:()=>g});var d=c(8732),e=c(82015),f=c(51302);let g=({isOpen:a,onClose:b,onSave:c,patient:g})=>{let[h,i]=(0,e.useState)("");return a?(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:b,children:(0,d.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg",onClick:a=>a.stopPropagation(),children:[(0,d.jsxs)("header",{className:"flex items-center justify-between p-5 border-b border-slate-200",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-lg font-bold text-slate-800",children:"Adicionar Observa\xe7\xe3o"}),(0,d.jsxs)("p",{className:"text-sm text-slate-500",children:["Para: ",g.name]})]}),(0,d.jsx)("button",{onClick:b,className:"p-2 rounded-full hover:bg-slate-100",children:(0,d.jsx)(f.X,{className:"w-5 h-5 text-slate-600"})})]}),(0,d.jsx)("main",{className:"p-6",children:(0,d.jsx)("textarea",{value:h,onChange:a=>i(a.target.value),rows:5,className:"w-full p-2 border border-slate-300 rounded-lg",placeholder:"Ex: Tentei contato por telefone, sem sucesso. Deixei recado na caixa postal.",autoFocus:!0})}),(0,d.jsxs)("footer",{className:"flex justify-end items-center p-4 border-t border-slate-200 bg-slate-50",children:[(0,d.jsx)("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 mr-2",children:"Cancelar"}),(0,d.jsxs)("button",{onClick:()=>{h.trim()&&c(g.id,h)},className:"px-4 py-2 text-sm font-medium text-white bg-teal-500 rounded-lg hover:bg-teal-600 flex items-center",children:[(0,d.jsx)(f.eMP,{className:"w-4 h-4 mr-2"})," Salvar"]})]})]})}):null}},30927:(a,b,c)=>{c.d(b,{A:()=>h});var d=c(72393),e=c(22320);let f=(a,b)=>{let c=new Date;return b.some(b=>b.patientId===a&&b.startTime>c&&b.status===d.y2.Scheduled)},g=a=>{let b=new Date(a);return Math.ceil(Math.abs(new Date().getTime()-b.getTime())/864e5)},h=async(a,b)=>{let c={abandonment:[],highRisk:[],attention:[],regular:[]},h=new Set,i=new Map;for(let j of a){if("Active"!==j.status)continue;let a=b.filter(a=>a.patientId===j.id).sort((a,b)=>b.startTime.getTime()-a.startTime.getTime()),k=g(j.lastVisit);if(k>7&&!f(j.id,b)){c.abandonment.push({...j,alertType:"abandonment",alertReason:`\xdaltima visita h\xe1 ${k} dias, sem novo agendamento.`}),h.add(j.id);continue}let l=a.filter(a=>a.startTime<new Date).slice(0,2);if(l.length>=2&&l.every(a=>a.status===d.y2.NoShow)){c.highRisk.push({...j,alertType:"highRisk",alertReason:`Faltou \xe0s \xfaltimas ${l.length} consultas. Contato urgente.`}),h.add(j.id);continue}i.has(j.id)||i.set(j.id,await e.z0(j.id));let m=i.get(j.id);if(m){let b=m.durationWeeks*m.frequencyPerWeek,e=a.filter(a=>a.status===d.y2.Completed).length;if(e>=.8*b&&e<b){c.attention.push({...j,alertType:"attention",alertReason:`Pr\xf3ximo da alta (${e}/${b} sess\xf5es). Planejar pr\xf3ximos passos.`}),h.add(j.id);continue}}}return a.forEach(a=>{"Active"!==a.status||h.has(a.id)||c.regular.push(a)}),c}},60899:(a,b,c)=>{c.d(b,{A:()=>l});var d=c(8732),e=c(82015),f=c(54822),g=c(72393),h=c(51302),i=c(28471),j=c(99597),k=c(26821);let l=({patient:a,onOpenObservationModal:b,onOpenRescheduleModal:c,onOpenAiSuggestion:l,onUpdate:m})=>{let{appointments:n}=(0,i.Ez)(),{showToast:o}=(0,j.dj)(),{user:p}=(0,i.As)(),q=f.useNavigate(),r=(0,e.useMemo)(()=>{let b=n.filter(b=>b.patientId===a.id).sort((a,b)=>a.startTime.getTime()-b.startTime.getTime()),c=b.filter(a=>a.startTime<new Date),d=b.filter(a=>a.startTime>=new Date&&a.status===g.y2.Scheduled),e=c.slice(-5).map(a=>a.status===g.y2.Completed);return{lastVisit:new Date(a.lastVisit).toLocaleDateString("pt-BR"),nextAppointment:d[0]?new Date(d[0].startTime).toLocaleDateString("pt-BR"):"Nenhuma",attendance:e}},[a,n]),s=async b=>{if(p)try{await k.Ob(a.id,{date:new Date().toISOString(),type:b,notes:`Tentativa de contato para acompanhamento via ${b}.`,actor:p.name}),o(`Contato com ${a.name} registrado.`,"success"),m()}catch(a){o("Falha ao registrar contato.","error")}},t={abandonment:{borderColor:"border-red-500",bgColor:"bg-red-50",textColor:"text-red-700"},highRisk:{borderColor:"border-amber-500",bgColor:"bg-amber-50",textColor:"text-amber-700"},attention:{borderColor:"border-sky-500",bgColor:"bg-sky-50",textColor:"text-sky-700"}}[a.alertType];return(0,d.jsxs)("div",{className:`bg-white rounded-2xl shadow-sm border-t-4 ${t.borderColor} overflow-hidden flex flex-col h-full`,children:[(0,d.jsxs)("div",{className:"p-4 flex-grow",children:[(0,d.jsx)("div",{className:"flex items-start justify-between cursor-pointer",onClick:()=>q(`/patients/${a.id}`),children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("img",{src:a.avatarUrl,alt:a.name,className:"w-12 h-12 rounded-full"}),(0,d.jsxs)("div",{className:"ml-3",children:[(0,d.jsx)("h3",{className:"font-bold text-slate-800",children:a.name}),(0,d.jsx)("p",{className:"text-xs text-slate-500",children:a.phone})]})]})}),(0,d.jsxs)("div",{className:`mt-3 p-2 text-xs font-semibold rounded-md flex items-center ${t.bgColor} ${t.textColor}`,children:[(0,d.jsx)(h.hcu,{size:14,className:"mr-2 shrink-0"}),(0,d.jsx)("p",{children:a.alertReason})]}),(0,d.jsxs)("div",{className:"mt-4 space-y-2 text-sm",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"\xdaltima Visita:"}),(0,d.jsx)("span",{className:"font-semibold text-slate-700",children:r.lastVisit})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Pr\xf3xima Consulta:"}),(0,d.jsx)("span",{className:"font-semibold text-slate-700",children:r.nextAppointment})]})]})]}),(0,d.jsxs)("div",{className:"bg-slate-50 p-2 flex justify-around items-center border-t mt-auto",children:[(0,d.jsxs)("button",{onClick:()=>l(a),title:"Sugest\xe3o de Contato com IA",className:"flex flex-col items-center text-xs text-slate-600 hover:text-teal-600 p-1 rounded-md w-1/5",children:[(0,d.jsx)(h.s6t,{size:20}),(0,d.jsx)("span",{children:"IA"})]}),(0,d.jsxs)("a",{href:`https://wa.me/${a.phone.replace(/\D/g,"")}`,target:"_blank",rel:"noopener noreferrer",onClick:()=>s("WhatsApp"),title:"Enviar WhatsApp",className:"flex flex-col items-center text-xs text-slate-600 hover:text-green-600 p-1 rounded-md w-1/5",children:[(0,d.jsx)(h.vEG,{size:20}),(0,d.jsx)("span",{children:"Chat"})]}),(0,d.jsxs)("button",{onClick:()=>c(a),title:"Remarcar Consulta",className:"flex flex-col items-center text-xs text-slate-600 hover:text-sky-600 p-1 rounded-md w-1/5",children:[(0,d.jsx)(h.$Ut,{size:20}),(0,d.jsx)("span",{children:"Remarcar"})]}),(0,d.jsxs)("button",{onClick:()=>s("Liga\xe7\xe3o"),title:"Registrar Liga\xe7\xe3o",className:"flex flex-col items-center text-xs text-slate-600 hover:text-purple-600 p-1 rounded-md w-1/5",children:[(0,d.jsx)(h.bcf,{size:20}),(0,d.jsx)("span",{children:"Liga\xe7\xe3o"})]}),(0,d.jsxs)("button",{onClick:()=>b(a),title:"Adicionar Observa\xe7\xe3o",className:"flex flex-col items-center text-xs text-slate-600 hover:text-amber-600 p-1 rounded-md w-1/5",children:[(0,d.jsx)(h.GJ1,{size:20}),(0,d.jsx)("span",{children:"Nota"})]})]})]})}},67820:(a,b,c)=>{c.d(b,{A:()=>j});var d=c(8732),e=c(82015),f=c(51302),g=c(5181),h=c(99597),i=c(77590);let j=({isOpen:a,onClose:b,patient:c})=>{let[j,k]=(0,e.useState)(""),[l,m]=(0,e.useState)(!1),[n,o]=(0,e.useState)(!1),{showToast:p}=(0,h.dj)();return((0,e.useEffect)(()=>{a&&(async()=>{m(!0),k("");try{let a=await (0,g.oP)({nome_paciente:c.name,motivo_alerta:c.alertReason});k(a)}catch(a){k("N\xe3o foi poss\xedvel gerar uma sugest\xe3o. Verifique sua conex\xe3o ou tente novamente."),p("Erro ao gerar sugest\xe3o da IA.","error")}finally{m(!1)}})()},[a,c,p]),a)?(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:b,children:(0,d.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col",onClick:a=>a.stopPropagation(),children:[(0,d.jsxs)("header",{className:"flex items-center justify-between p-5 border-b border-slate-200",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("h2",{className:"text-lg font-bold text-slate-800 flex items-center",children:[(0,d.jsx)(f.s6t,{className:"w-5 h-5 mr-3 text-teal-500"}),"Sugest\xe3o da IA"]}),(0,d.jsxs)("p",{className:"text-sm text-slate-500",children:["Para: ",c.name]})]}),(0,d.jsx)("button",{onClick:b,className:"p-2 rounded-full hover:bg-slate-100",children:(0,d.jsx)(f.X,{className:"w-5 h-5 text-slate-600"})})]}),(0,d.jsx)("main",{className:"flex-1 overflow-y-auto p-6",children:l?(0,d.jsx)("div",{className:"flex items-center justify-center h-48",children:(0,d.jsx)(f.aHM,{className:"w-8 h-8 animate-spin text-teal-500"})}):(0,d.jsx)("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:(0,d.jsx)(i.A,{content:j})})}),(0,d.jsxs)("footer",{className:"flex justify-end items-center p-4 border-t border-slate-200 bg-slate-50",children:[(0,d.jsx)("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 mr-2",children:"Fechar"}),(0,d.jsxs)("button",{onClick:()=>{j&&(navigator.clipboard.writeText(j),o(!0),p("Sugest\xe3o copiada!","success"),setTimeout(()=>o(!1),2e3))},disabled:l||n,className:"px-4 py-2 text-sm font-medium text-white bg-teal-500 rounded-lg hover:bg-teal-600 flex items-center disabled:bg-teal-300",children:[n?(0,d.jsx)(f.Jlk,{className:"w-4 h-4 mr-2"}):(0,d.jsx)(f.B0c,{className:"w-4 h-4 mr-2"}),n?"Copiado!":"Copiar Texto"]})]})]})}):null}},96023:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>t});var e=c(8732),f=c(82015),g=c(42227),h=c(28471),i=c(99597),j=c(30927),k=c(19119),l=c(60899),m=c(8926),n=c(31761),o=c(67820),p=c(26821),q=c(737),r=a([k,n]);[k,n]=r.then?(await r)():r;let s=({title:a,patients:b,color:c,children:d,onOpenObservationModal:f,onOpenRescheduleModal:g,onOpenAiSuggestion:h,onUpdate:i})=>(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:`flex items-center mb-4 pb-2 border-b-2 ${c}`,children:[(0,e.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:a}),(0,e.jsx)("span",{className:"ml-2 bg-slate-200 text-slate-700 text-sm font-semibold w-6 h-6 flex items-center justify-center rounded-full",children:b.length})]}),d,(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:b.map(a=>(0,e.jsx)(l.A,{patient:a,onOpenObservationModal:f,onOpenRescheduleModal:g,onOpenAiSuggestion:h,onUpdate:i},a.id))})]}),t=()=>{let{therapists:a,isLoading:b,refetch:c}=(0,h.Ez)(),{showToast:d}=(0,i.dj)(),{user:l}=(0,h.As)(),[r,t]=(0,f.useState)([]),[u,v]=(0,f.useState)(null),[w,x]=(0,f.useState)(!0),[y,z]=(0,f.useState)({isOpen:!1,patient:null}),[A,B]=(0,f.useState)({isOpen:!1,patient:null}),[C,D]=(0,f.useState)({isOpen:!1,patient:null}),E=(0,f.useCallback)(async()=>{x(!0);try{let[a,b]=await Promise.all([p.uE(),q.Xj()]),c=await j.A(a,b);t(b),v(c)}catch(a){d("Erro ao processar dados de acompanhamento.","error")}finally{x(!1)}},[d]);(0,f.useEffect)(()=>{E()},[E]);let F=async a=>{try{return await q.Fy(a),d("Consulta remarcada com sucesso!","success"),B({isOpen:!1,patient:null}),E(),c(),!0}catch(a){return d("Falha ao salvar a consulta.","error"),!1}},G=async(a,b)=>{l&&(await p.Ob(a,{date:new Date().toISOString(),type:"Outro",notes:b,actor:l.name}),d(`Observa\xe7\xe3o adicionada.`,"success"),z({isOpen:!1,patient:null}),E(),c())},H=a=>z({isOpen:!0,patient:a}),I=a=>B({isOpen:!0,patient:a}),J=a=>D({isOpen:!0,patient:a}),K=()=>{E(),c()};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g.A,{title:"Acompanhamento de Pacientes",subtitle:"Painel de controle para monitorar a ader\xeancia e o progresso dos pacientes."}),y.patient&&(0,e.jsx)(m.A,{isOpen:y.isOpen,onClose:()=>z({isOpen:!1,patient:null}),onSave:G,patient:y.patient}),A.patient&&(0,e.jsx)(n.A,{isOpen:A.isOpen,onClose:()=>B({isOpen:!1,patient:null}),onSave:F,onDelete:async()=>(d("A\xe7\xe3o n\xe3o permitida aqui.","info"),!1),patients:[A.patient],therapists:a,allAppointments:r}),C.patient&&(0,e.jsx)(o.A,{isOpen:C.isOpen,onClose:()=>D({isOpen:!1,patient:null}),patient:C.patient}),b||w?(0,e.jsx)(k.E,{className:"h-[60vh] w-full rounded-2xl"}):(0,e.jsxs)("div",{className:"space-y-10",children:[u?.abandonment&&u.abandonment.length>0&&(0,e.jsx)(s,{title:"Abandono de Tratamento",patients:u.abandonment,color:"border-red-500",onUpdate:K,onOpenObservationModal:H,onOpenRescheduleModal:I,onOpenAiSuggestion:J,children:(0,e.jsx)("p",{className:"text-sm text-slate-600 mb-4 -mt-3",children:'Pacientes com status "Ativo", \xfaltima visita h\xe1 mais de 7 dias e sem agendamentos futuros. A\xe7\xe3o imediata recomendada.'})}),u?.highRisk&&u.highRisk.length>0&&(0,e.jsx)(s,{title:"Risco Elevado",patients:u.highRisk,color:"border-amber-500",onUpdate:K,onOpenObservationModal:H,onOpenRescheduleModal:I,onOpenAiSuggestion:J,children:(0,e.jsx)("p",{className:"text-sm text-slate-600 mb-4 -mt-3",children:"Pacientes com faltas consecutivas ou que ultrapassaram a data prevista de alta sem finalizar o tratamento."})}),u?.attention&&u.attention.length>0&&(0,e.jsx)(s,{title:"Pontos de Aten\xe7\xe3o",patients:u.attention,color:"border-sky-500",onUpdate:K,onOpenObservationModal:H,onOpenRescheduleModal:I,onOpenAiSuggestion:J,children:(0,e.jsx)("p",{className:"text-sm text-slate-600 mb-4 -mt-3",children:"Pacientes com boa evolu\xe7\xe3o e pr\xf3ximos da data de alta. Ideal para planejar os pr\xf3ximos passos."})}),u&&0===u.abandonment.length&&0===u.highRisk.length&&0===u.attention.length&&(0,e.jsxs)("div",{className:"text-center p-12 bg-white rounded-2xl shadow-sm",children:[(0,e.jsx)("h3",{className:"text-lg font-semibold text-slate-700",children:"Tudo em ordem!"}),(0,e.jsx)("p",{className:"text-slate-500 mt-1",children:"Nenhum paciente foi sinalizado nos grupos de acompanhamento."})]})]})]})};d()}catch(a){d(a)}})}};