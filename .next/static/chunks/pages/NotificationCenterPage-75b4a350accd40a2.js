(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1211],{117:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>I});var s=a(37876),r=a(14232),i=a(35880),o=a(41547),n=a(14776),l=a(66766),d=a(39303),c=a(75345);let m=[...l.pG],h=e=>new Promise(t=>setTimeout(t,e)),u=async e=>{if(!e)return;let t=new Date().toDateString();if(e.role===n.Xh.Therapist||e.role===n.Xh.Admin){let a="appointment_reminder_sent_".concat(e.id,"_").concat(t);if(sessionStorage.getItem(a))return;let s=new Date,r=new Date(s);r.setDate(s.getDate()+1);let i=l.ZS.filter(t=>{let a=t.startTime;return t.therapistId===e.id&&(a.toDateString()===s.toDateString()||a.toDateString()===r.toDateString())&&t.status===n.y2.Scheduled});for(let a of(i.forEach(t=>{if(!m.some(a=>a.userId===e.id&&"appointment_reminder"===a.type&&a.message.includes(t.patientName)&&a.message.includes(t.startTime.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})))){let a=t.startTime.toDateString()===s.toDateString()?"hoje":"amanh\xe3",r={id:"notif_appt_".concat(t.id),userId:e.id,message:"Lembrete: Consulta com ".concat(t.patientName," ").concat(a," \xe0s ").concat(t.startTime.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),"."),isRead:!1,createdAt:new Date,type:"appointment_reminder"};m.unshift(r)}}),i.filter(e=>e.startTime.toDateString()===t&&e.startTime>s))){let e=l.N.find(e=>e.id===a.patientId);e&&await c.YU(a,e,0)}i.length>0&&sessionStorage.setItem(a,"true")}if(e.role===n.Xh.Patient&&e.patientId){let a="exercise_reminder_sent_".concat(e.id,"_").concat(t);if(sessionStorage.getItem(a))return;let s=await d.z0(e.patientId);if(s&&s.exercises&&s.exercises.length>0){let t={id:"notif_ex_".concat(Date.now()),userId:e.id,message:"Lembrete di\xe1rio: N\xe3o se esque\xe7a de fazer seus exerc\xedcios de hoje para acelerar sua recupera\xe7\xe3o!",isRead:!1,createdAt:new Date,type:"exercise_reminder"};m.unshift(t),sessionStorage.setItem(a,"true")}}},x=async e=>(await h(300),[...m].filter(t=>t.userId===e).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())),p=async(e,t)=>{await h(100);let a=m.find(a=>a.id===e&&a.userId===t);return a&&(a.isRead=!0),a},f=async e=>{await h(200);let t=m.filter(t=>t.userId===e);return t.forEach(e=>e.isRead=!0),t},g=async(e,t)=>{await h(500),l.rB.filter(e=>e.role===t).forEach(t=>{let a={id:"notif_".concat(Date.now(),"_").concat(t.id),userId:t.id,message:"Comunicado: ".concat(e),isRead:!1,createdAt:new Date,type:"announcement"};m.unshift(a)})};var b=a(66822),w=a(74062),y=a(17963);let v=(0,y.A)("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]),j=(0,y.A)("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);var k=a(57762),N=a(90434),A=a(61052),_=a(28113),C=a(29998),T=a(93336);let M=(0,y.A)("inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);var S=a(6782);let D=e=>{let{notification:t,onMarkAsRead:a}=e;return(0,s.jsxs)("div",{onClick:()=>!t.isRead&&a(t.id),className:"flex items-start p-4 border-b border-slate-200 transition-colors duration-200 ".concat(t.isRead?"bg-white":"bg-sky-50/50 hover:bg-sky-100 cursor-pointer"),children:[(0,s.jsxs)("div",{className:"flex-shrink-0 relative",children:[!t.isRead&&(0,s.jsx)("span",{className:"absolute -left-1 top-2 h-2 w-2 rounded-full bg-sky-500"}),(0,s.jsx)("div",{className:"p-2 bg-slate-100 rounded-full ml-2",children:(e=>{switch(e){case"task_assigned":return(0,s.jsx)(w.A,{className:"w-5 h-5 text-purple-500"});case"announcement":return(0,s.jsx)(v,{className:"w-5 h-5 text-amber-500"});case"appointment_reminder":return(0,s.jsx)(j,{className:"w-5 h-5 text-sky-500"});case"exercise_reminder":return(0,s.jsx)(k.A,{className:"w-5 h-5 text-teal-500"});default:return(0,s.jsx)(N.A,{className:"w-5 h-5 text-slate-500"})}})(t.type)})]}),(0,s.jsxs)("div",{className:"ml-4 flex-grow",children:[(0,s.jsx)("p",{className:"text-sm text-slate-700",children:t.message}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:(e=>{let t=Math.floor((new Date().getTime()-e.getTime())/1e3);if(t<60)return"agora mesmo";let a=Math.floor(t/60);if(a<60)return"h\xe1 ".concat(a," min");let s=Math.floor(a/60);if(s<24)return"h\xe1 ".concat(s,"h");let r=Math.floor(s/24);return"h\xe1 ".concat(r,"d")})(t.createdAt)})]})]})},E=e=>{let{onSent:t}=e,[a,i]=(0,r.useState)(""),[o,l]=(0,r.useState)(n.Xh.Therapist),[d,c]=(0,r.useState)(!1),{showToast:m}=(0,b.dj)(),h=async e=>{if(e.preventDefault(),!a.trim())return void m("A mensagem n\xe3o pode estar vazia.","error");c(!0);try{await g(a,o),m("Comunicado enviado com sucesso!","success"),i(""),t()}catch(e){m("Falha ao enviar comunicado.","error")}finally{c(!1)}};return(0,s.jsxs)("form",{onSubmit:h,className:"p-6 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"broadcast-message",className:"block text-sm font-medium text-slate-700",children:"Mensagem"}),(0,s.jsx)("textarea",{id:"broadcast-message",rows:4,value:a,onChange:e=>i(e.target.value),className:"mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500",placeholder:"Digite seu comunicado aqui..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"target-group",className:"block text-sm font-medium text-slate-700",children:"Destinat\xe1rios"}),(0,s.jsxs)("select",{id:"target-group",value:o,onChange:e=>l(e.target.value),className:"mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500",children:[(0,s.jsx)("option",{value:n.Xh.Therapist,children:"Todos os Fisioterapeutas"}),(0,s.jsx)("option",{value:n.Xh.Patient,children:"Todos os Pacientes"}),(0,s.jsx)("option",{value:n.Xh.EducadorFisico,children:"Todos os Educadores F\xedsicos"})]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsxs)("button",{type:"submit",disabled:d,className:"inline-flex items-center justify-center rounded-lg border border-transparent bg-teal-500 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-teal-600 disabled:bg-teal-300",children:[d?(0,s.jsx)(A.A,{className:"w-5 h-5 mr-2 animate-spin"}):(0,s.jsx)(_.A,{className:"w-5 h-5 mr-2"}),d?"Enviando...":"Enviar Comunicado"]})})]})},I=()=>{let[e,t]=(0,r.useState)("my"),{user:a}=(0,o.As)(),{notifications:l,isLoading:d,unreadCount:c,markAsRead:m,markAllAsRead:h,refetch:g}=(e=>{let[t,a]=(0,r.useState)([]),[s,i]=(0,r.useState)(!0),{user:n}=(0,o.As)(),l=(0,r.useCallback)(async()=>{if(!e){i(!1),a([]);return}i(!0);try{await u(n);let t=await x(e);a(t)}catch(e){console.error("Failed to fetch notifications:",e)}finally{i(!1)}},[e,n]);(0,r.useEffect)(()=>{l()},[l]);let d=(0,r.useCallback)(async t=>{e&&(a(e=>e.map(e=>e.id===t?{...e,isRead:!0}:e)),await p(t,e))},[e]),c=(0,r.useCallback)(async()=>{e&&(a(e=>e.map(e=>({...e,isRead:!0}))),await f(e))},[e]),m=(0,r.useMemo)(()=>t.filter(e=>!e.isRead).length,[t]);return{notifications:t,isLoading:s,unreadCount:m,markAsRead:d,markAllAsRead:c,refetch:l}})((null==a?void 0:a.id)||"");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.A,{title:"Centro de Notifica\xe7\xf5es",subtitle:"Acompanhe suas mensagens e envie comunicados para a equipe."}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[(0,s.jsx)("div",{className:"border-b border-slate-200",children:(0,s.jsxs)("nav",{className:"flex space-x-4 px-6","aria-label":"Tabs",children:[(0,s.jsxs)("button",{onClick:()=>t("my"),className:"flex items-center whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("my"===e?"border-teal-500 text-teal-600":"border-transparent text-slate-500 hover:text-slate-700"),children:[(0,s.jsx)(N.A,{className:"w-5 h-5 mr-2"}),"Minhas Notifica\xe7\xf5es ",c>0&&(0,s.jsx)("span",{className:"ml-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center",children:c})]}),(null==a?void 0:a.role)===n.Xh.Admin&&(0,s.jsxs)("button",{onClick:()=>t("broadcast"),className:"flex items-center whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("broadcast"===e?"border-teal-500 text-teal-600":"border-transparent text-slate-500 hover:text-slate-700"),children:[(0,s.jsx)(C.A,{className:"w-5 h-5 mr-2"}),"Enviar Comunicado"]})]})}),"my"===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"p-4 flex justify-end border-b border-slate-200",children:(0,s.jsxs)("button",{onClick:h,disabled:0===c,className:"inline-flex items-center text-sm font-medium text-teal-600 hover:text-teal-800 disabled:text-slate-400 disabled:cursor-not-allowed",children:[(0,s.jsx)(T.A,{className:"w-5 h-5 mr-2"}),"Marcar todas como lidas"]})}),d?Array.from({length:3}).map((e,t)=>(0,s.jsx)(S.E,{className:"h-20 w-full"},t)):l.length>0?(0,s.jsx)("div",{className:"divide-y divide-slate-200",children:l.map(e=>(0,s.jsx)(D,{notification:e,onMarkAsRead:m},e.id))}):(0,s.jsxs)("div",{className:"text-center p-12",children:[(0,s.jsx)(M,{className:"w-16 h-16 mx-auto text-slate-300 mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-slate-700",children:"Caixa de entrada vazia"}),(0,s.jsx)("p",{className:"text-slate-500 mt-1",children:"Voc\xea n\xe3o tem nenhuma notifica\xe7\xe3o no momento."})]})]}),"broadcast"===e&&(null==a?void 0:a.role)===n.Xh.Admin&&(0,s.jsx)(E,{onSent:g})]})]})}},29998:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(17963).A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},57762:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(17963).A)("dumbbell",[["path",{d:"M17.596 12.768a2 2 0 1 0 2.829-2.829l-1.768-1.767a2 2 0 0 0 2.828-2.829l-2.828-2.828a2 2 0 0 0-2.829 2.828l-1.767-1.768a2 2 0 1 0-2.829 2.829z",key:"9m4mmf"}],["path",{d:"m2.5 21.5 1.4-1.4",key:"17g3f0"}],["path",{d:"m20.1 3.9 1.4-1.4",key:"1qn309"}],["path",{d:"M5.343 21.485a2 2 0 1 0 2.829-2.828l1.767 1.768a2 2 0 1 0 2.829-2.829l-6.364-6.364a2 2 0 1 0-2.829 2.829l1.768 1.767a2 2 0 0 0-2.828 2.829z",key:"1t2c92"}],["path",{d:"m9.6 14.4 4.8-4.8",key:"6umqxw"}]])},66822:(e,t,a)=>{"use strict";a.d(t,{dj:()=>o}),a(37876);var s=a(14232);let r=(0,s.createContext)(void 0),i=(0,s.createContext)(void 0),o=()=>{let e=(()=>{let e=(0,s.useContext)(r);return void 0===e?{enabled:!1,logRouterChange:()=>{},logHookCall:()=>{},logContextAccess:()=>{}}:e})(),t=(0,s.useContext)(i);if(e.logContextAccess("ToastContext","useToast"),!t){let e=Error("useToast must be used within a ToastProvider");throw console.error("âŒ Toast Context Error:",e.message),e}return{showToast:t.showToast}}},74062:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(17963).A)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]])},75102:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/NotificationCenterPage",function(){return a(117)}])},90434:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(17963).A)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]])}},e=>{e.O(0,[2749,5898,2170,6766,5977,1547,196,636,6593,8792],()=>e(e.s=75102)),_N_E=e.O()}]);