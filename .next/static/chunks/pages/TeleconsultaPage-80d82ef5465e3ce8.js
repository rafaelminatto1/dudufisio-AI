(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6280],{6782:(e,t,s)=>{"use strict";s.d(t,{E:()=>r});var a=s(37876),l=s(93704);function r(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,l.cn)("animate-pulse rounded-md bg-muted",t),...s})}},25040:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(37876),l=s(14232);let r={front:"\n        M100,20 C115,20 125,30 125,45 S115,70 100,70 S75,60 75,45 S85,20 100,20 Z\n        M100,70 L100,80\n        M100,80 C130,80 140,90 140,120 L140,180\n        M100,80 C70,80 60,90 60,120 L60,180\n        M140,120 L160,120 L165,250 L155,250 Z\n        M60,120 L40,120 L35,250 L45,250 Z\n        M100,180 C120,180 125,185 125,200 L125,350 L115,350 L115,480 L125,490 L125,500 L105,500 Z\n        M100,180 C80,180 75,185 75,200 L75,350 L85,350 L85,480 L75,490 L75,500 L95,500 Z\n    ",back:"\n        M100,20 C115,20 125,30 125,45 S115,70 100,70 S75,60 75,45 S85,20 100,20 Z\n        M100,70 L100,80\n        M100,80 C130,80 140,90 140,120 L140,180\n        M100,80 C70,80 60,90 60,120 L60,180\n        M140,120 L160,120 L165,250 L155,250 Z\n        M60,120 L40,120 L35,250 L45,250 Z\n        M100,180 C120,180 125,185 125,200 L125,350 L115,350 L115,480 L125,490 L125,500 L105,500 Z\n        M100,180 C80,180 75,185 75,200 L75,350 L85,350 L85,480 L75,490 L75,500 L95,500 Z\n        M100,85 L100,175\n    "},n=e=>{let{points:t,onMapClick:s,onPointClick:n}=e,[i,c]=(0,l.useState)(null),o=(0,l.useRef)(null),d=()=>{c(null)};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"flex justify-center gap-4",children:["front","back"].map(e=>(0,a.jsxs)("div",{className:"w-1/2",children:[(0,a.jsx)("h4",{className:"text-center font-semibold text-sm text-slate-600 mb-1 capitalize",children:"front"===e?"Frente":"Costas"}),(0,a.jsxs)("svg",{ref:o,viewBox:"0 0 200 500",onClick:t=>((e,t)=>{if(!o.current)return;let a=o.current.getBoundingClientRect();s((e.clientX-a.left)/a.width*100,(e.clientY-a.top)/a.height*100,t)})(t,e),className:"w-full cursor-crosshair",children:[(0,a.jsx)("path",{d:r[e],className:"fill-slate-200",stroke:"#94a3b8",strokeWidth:"1"}),t.filter(t=>t.bodyPart===e).map(e=>(0,a.jsx)("circle",{cx:"".concat(e.x,"%"),cy:"".concat(e.y,"%"),r:"5",className:"cursor-pointer transition-all hover:r-7 ".concat((e=>e<=3?"fill-green-500/80 stroke-green-700":e<=6?"fill-yellow-500/80 stroke-yellow-700":"fill-red-500/80 stroke-red-700")(e.intensity)),strokeWidth:"1.5",onClick:t=>{t.stopPropagation(),n(e)},onMouseEnter:t=>((e,t)=>{c({content:"Intensidade: ".concat(t.intensity,"/10\nTipo: ").concat(t.type,"\nData: ").concat(new Date(t.date).toLocaleDateString()),x:e.pageX,y:e.pageY})})(t,e),onMouseLeave:d},e.id))]})]},e))}),i&&(0,a.jsx)("div",{style:{top:i.y,left:i.x},className:"absolute z-10 p-2 text-xs text-white bg-slate-800 rounded-md shadow-lg pointer-events-none transform -translate-y-full -translate-x-1/2 whitespace-pre-wrap",children:i.content})]})}},28647:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a=s(37876),l=s(14232),r=s(94504),n=s(42775),i=s(46443);let c=e=>{let{value:t,onChange:s,rows:c=3,placeholder:o,disabled:d=!1}=e,m=(0,l.useRef)(null),u=e=>{let a=m.current;if(!a||d)return;let l="",r=a.selectionStart,n=a.selectionEnd,i=t.substring(r,n),c="";if("list"===e){let e=t.lastIndexOf("\n",r-1)+1,s=t.substring(0,e),a=t.substring(e,n),l=t.substring(n),i=a.split("\n"),o=i.every(e=>e.trim().startsWith("* ")),d=i.map(e=>o?e.replace(/^\s*\*\s?/,""):e.trim()?"* ".concat(e):e).join("\n");c="".concat(s).concat(d).concat(l)}else{l="bold"===e?"**":"*";let s="".concat(l).concat(i).concat(l);c="".concat(t.substring(0,r)).concat(s).concat(t.substring(n))}s(c),setTimeout(()=>{a.focus(),"list"!==e&&(a.selectionStart=r+l.length,a.selectionEnd=n+l.length)},0)};return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 border border-b-0 border-slate-300 p-2 rounded-t-lg ".concat(d?"bg-slate-200":"bg-slate-50"),children:[(0,a.jsx)("button",{type:"button",onClick:()=>u("bold"),className:"p-1.5 rounded hover:bg-slate-200 disabled:opacity-50",title:"Negrito (Ctrl+B)",disabled:d,children:(0,a.jsx)(r.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{type:"button",onClick:()=>u("italic"),className:"p-1.5 rounded hover:bg-slate-200 disabled:opacity-50",title:"It\xe1lico (Ctrl+I)",disabled:d,children:(0,a.jsx)(n.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{type:"button",onClick:()=>u("list"),className:"p-1.5 rounded hover:bg-slate-200 disabled:opacity-50",title:"Lista",disabled:d,children:(0,a.jsx)(i.A,{className:"w-4 h-4"})})]}),(0,a.jsx)("textarea",{ref:m,value:t,onChange:e=>s(e.target.value),rows:c,placeholder:o,className:"w-full p-2 border border-slate-300 rounded-b-lg focus:outline-none focus:ring-1 focus:ring-sky-500 text-sm flex-1 ".concat(d?"bg-slate-100 cursor-not-allowed":""),"aria-label":"Editor de Texto do Relat\xf3rio",disabled:d})]})}},37268:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/TeleconsultaPage",function(){return s(46082)}])},39194:(e,t,s)=>{"use strict";s.d(t,{Cq:()=>c,gp:()=>i,lV:()=>n});var a=s(748),l=s(87107);let r=e=>new Promise(t=>setTimeout(t,e)),n=async e=>(await r(300),[...a.db.getSoapNotes()].filter(t=>t.patientId===e).sort((e,t)=>new Date(t.date.split("/").reverse().join("-")).getTime()-new Date(e.date.split("/").reverse().join("-")).getTime())),i=async(e,t)=>{await r(400);let s={id:"note_".concat(Date.now()),patientId:e,therapist:"Dr. Roberto",...t};return a.db.saveSoapNote(s),l.g.emit("notes:changed"),s},c=async e=>{let t;return await r(300),t=e.id?{...a.db.getSoapNotes().find(t=>t.id===e.id),...e}:{id:"note_".concat(Date.now()),therapist:"Dr. Roberto",date:new Date().toLocaleDateString("pt-BR"),subjective:"",objective:"",assessment:"",plan:"",...e},a.db.saveSoapNote(t),l.g.emit("notes:changed"),t}},39303:(e,t,s)=>{"use strict";s.d(t,{Fq:()=>i,td:()=>c,z0:()=>n});var a=s(748),l=s(87107);let r=e=>new Promise(t=>setTimeout(t,e)),n=async e=>{await r(300);let t=a.db.getTreatmentPlans().find(t=>t.patientId===e);if(t){let e=await i(t.id);return{...t,exercises:e}}},i=async e=>(await r(300),a.db.getExercisePrescriptions().filter(t=>t.treatmentPlanId===e)),c=async(e,t)=>{await r(400);let s=a.db.getTreatmentPlans(),n=s.findIndex(t=>t.patientId===e);if(n>-1){let e=s[n],r=(t.exercises||[]).map((t,s)=>({id:"ex_".concat(Date.now(),"_").concat(s),treatmentPlanId:e.id,exerciseName:t.exerciseName,sets:t.sets,repetitions:t.repetitions,resistanceLevel:"A definir",progressionCriteria:"A definir"})),i={...e,treatmentGoals:t.treatmentGoals||e.treatmentGoals,exercises:r.length>0?r:e.exercises};return a.db.updateTreatmentPlan(i),a.db.setExercisePrescriptionsForPlan(e.id,r),l.g.emit("treatmentPlans:changed"),i}throw Error("Plano de tratamento n\xe3o encontrado para este paciente.")}},42085:(e,t,s)=>{"use strict";s.d(t,{Ah:()=>u,CC:()=>h,C_:()=>m,K7:()=>p,O7:()=>d,WV:()=>o,st:()=>x,t5:()=>c,xY:()=>i});var a=s(66766);let l=[...a.St],r=[...new Set(a.St.map(e=>e.category))].sort(),n=e=>new Promise(t=>setTimeout(t,e)),i=async()=>(await n(500),{exercises:[...l].sort((e,t)=>e.name.localeCompare(t.name)),categories:[...r]}),c=async e=>(await n(50),l.find(t=>t.name.toLowerCase()===e.toLowerCase())),o=async e=>{await n(400);let t={id:"ex_".concat(Date.now()),...e};return r.includes(t.category)||(r.push(t.category),r.sort()),l.unshift(t),t},d=async e=>(await n(400),l=l.map(t=>t.id===e.id?e:t),r.includes(e.category)||(r.push(e.category),r.sort()),e),m=async e=>{await n(400),l=l.filter(t=>t.id!==e)},u=async e=>{await n(100),r.includes(e)||(r.push(e),r.sort())},x=async(e,t)=>{await n(200);let s=r.indexOf(e);s>-1&&(r[s]=t,r.sort()),l=l.map(s=>s.category===e?{...s,category:t}:s)},h=async(e,t)=>{await n(300),r.includes(t)||(r.push(t),r.sort());let s=l.filter(t=>t.category===e).map(e=>({...e,id:"ex_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),name:"".concat(e.name),category:t}));l.push(...s)},p=async e=>{await n(200),r=r.filter(t=>t!==e),l=l.filter(t=>t.category!==e)}},42380:(e,t,s)=>{"use strict";s.d(t,{F:()=>n});var a=s(14232),l=s(42085),r=s(66822);let n=()=>{let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null),{showToast:m}=(0,r.dj)(),u=(0,a.useCallback)(async()=>{c(!0);try{let{exercises:e,categories:s}=await l.xY();t(e),n(s),d(null)}catch(e){d(e),m("Falha ao carregar exerc\xedcios.","error")}finally{c(!1)}},[m]);(0,a.useEffect)(()=>{u()},[u]);let x=(0,a.useMemo)(()=>[...new Set(e.flatMap(e=>e.bodyParts))].sort((e,t)=>e.localeCompare(t)),[e]),h=(0,a.useMemo)(()=>[...new Set(e.flatMap(e=>e.equipment))].sort((e,t)=>e.localeCompare(t)),[e]),p=async e=>{try{await l.WV(e),m("Exerc\xedcio adicionado com sucesso!","success"),await u()}catch(e){m("Falha ao adicionar exerc\xedcio.","error")}},f=async e=>{try{await l.O7(e),m("Exerc\xedcio atualizado com sucesso!","success"),await u()}catch(e){m("Falha ao atualizar exerc\xedcio.","error")}},b=async e=>{try{await l.C_(e),m("Exerc\xedcio exclu\xeddo com sucesso!","success"),await u()}catch(e){m("Falha ao excluir exerc\xedcio.","error")}},g=async e=>{try{await l.Ah(e),m('Grupo "'.concat(e,'" criado com sucesso!'),"success"),await u()}catch(e){m("Falha ao criar grupo.","error")}},j=async(e,t)=>{try{await l.st(e,t),m("Grupo renomeado com sucesso!","success"),await u()}catch(e){m("Falha ao renomear grupo.","error")}},v=async(e,t)=>{try{await l.CC(e,t),m('Grupo "'.concat(e,'" copiado para "').concat(t,'"!'),"success"),await u()}catch(e){m("Falha ao copiar grupo.","error")}},w=async e=>{try{await l.K7(e),m('Grupo "'.concat(e,'" e seus exerc\xedcios foram exclu\xeddos.'),"success"),await u()}catch(e){m("Falha ao excluir grupo.","error")}};return{exercises:e,categories:s,isLoading:i,error:o,refetch:u,addExercise:p,updateExercise:f,deleteExercise:b,addCategory:g,updateCategory:j,copyCategory:v,deleteCategory:w,uniqueBodyParts:x,uniqueEquipment:h}}},46082:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>X});var a=s(37876),l=s(14232),r=s(88307),n=s(41547),i=s(88635),c=s(15682),o=s(82518),d=s(23478),m=s(25946),u=s(52593),x=s(20858);let h=e=>{let{onClick:t,children:s,className:l="",title:r,disabled:n=!1}=e;return(0,a.jsx)("button",{onClick:t,title:r,disabled:n,className:"p-3 rounded-full transition-colors ".concat(l),children:s})},p=e=>{let{isMicOn:t,isCameraOn:s,onToggleMic:l,onToggleCamera:r,onEndCall:n}=e;return(0,a.jsxs)("div",{className:"flex justify-center items-center gap-4 bg-slate-800/50 p-2 rounded-xl max-w-md mx-auto",children:[(0,a.jsx)(h,{onClick:l,className:t?"bg-slate-700 hover:bg-slate-600":"bg-red-500 hover:bg-red-600",title:t?"Desativar microfone":"Ativar microfone",children:t?(0,a.jsx)(c.A,{className:"w-6 h-6"}):(0,a.jsx)(o.A,{className:"w-6 h-6"})}),(0,a.jsx)(h,{onClick:r,className:s?"bg-slate-700 hover:bg-slate-600":"bg-red-500 hover:bg-red-600",title:s?"Desativar c\xe2mera":"Ativar c\xe2mera",children:s?(0,a.jsx)(d.A,{className:"w-6 h-6"}):(0,a.jsx)(m.A,{className:"w-6 h-6"})}),(0,a.jsx)(h,{className:"bg-slate-700 hover:bg-slate-600 disabled:opacity-50",title:"Compartilhar tela (em breve)",disabled:!0,children:(0,a.jsx)(u.A,{className:"w-6 h-6"})}),(0,a.jsx)(h,{onClick:n,className:"bg-red-600 hover:bg-red-700",title:"Encerrar chamada",children:(0,a.jsx)(x.A,{className:"w-6 h-6"})})]})};var f=s(66822),b=s(73303),g=s(2577),j=s(12572);let v=e=>{let{stream:t,isMuted:s,isCameraOn:r,username:n}=e,i=(0,l.useRef)(null);return(0,l.useEffect)(()=>{i.current&&t&&(i.current.srcObject=t)},[t]),(0,a.jsxs)("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center relative",children:[r?(0,a.jsx)("video",{ref:i,autoPlay:!0,playsInline:!0,muted:s,className:"w-full h-full object-cover"}):(0,a.jsxs)("div",{className:"flex flex-col items-center text-slate-400",children:[(0,a.jsx)(j.A,{className:"w-16 h-16"}),(0,a.jsx)("p",{className:"mt-2 font-semibold",children:n}),(0,a.jsxs)("div",{className:"mt-1 flex items-center text-xs bg-slate-700 px-2 py-1 rounded-full",children:[(0,a.jsx)(m.A,{className:"w-3 h-3 mr-1.5"}),"C\xe2mera desligada"]})]}),(0,a.jsx)("div",{className:"absolute bottom-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded-md",children:n})]})};var w=s(25040),N=s(8328);let y=e=>{let{patientStream:t,therapistStream:s,isTherapistCameraOn:l,sharedContent:r}=e;return(0,a.jsxs)("div",{className:"flex-1 bg-black rounded-lg overflow-hidden relative",children:[r?(()=>{if(!r)return null;switch(r.type){case"exercise":return(0,a.jsxs)("div",{className:"w-full h-full bg-black flex flex-col items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"w-full max-w-2xl aspect-video bg-slate-800 rounded-lg overflow-hidden",children:r.data.media.videoUrl?(0,a.jsx)("video",{src:r.data.media.videoUrl,controls:!0,autoPlay:!0,loop:!0,className:"w-full h-full object-contain"}):(0,a.jsxs)("div",{className:"w-full h-full flex items-center justify-center text-slate-400",children:[(0,a.jsx)(N.A,{className:"w-16 h-16 mb-4"}),(0,a.jsx)("p",{children:"Este exerc\xedcio n\xe3o possui v\xeddeo."})]})}),(0,a.jsx)("h3",{className:"text-xl font-bold mt-4",children:r.data.name}),(0,a.jsx)("p",{className:"text-slate-300",children:r.data.description})]});case"painMap":return(0,a.jsxs)("div",{className:"w-full h-full bg-slate-100 flex flex-col items-center justify-center p-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Mapa de Dor do Paciente"}),(0,a.jsx)("div",{className:"w-full max-w-sm",children:(0,a.jsx)(w.A,{points:r.data||[],onMapClick:()=>{},onPointClick:()=>{}})})]});default:return null}})():(0,a.jsx)(v,{stream:t,isMuted:!1,isCameraOn:!0,username:"Paciente (Simulado)"}),(0,a.jsx)("div",{className:"absolute bottom-4 right-4 w-64 h-40 bg-black rounded-lg overflow-hidden border-2 border-slate-700 shadow-lg",children:(0,a.jsx)(v,{stream:s,isMuted:!0,isCameraOn:l,username:"Fisioterapeuta"})})]})};var C=s(57762),S=s(6781),A=s(74062),L=s(83981),k=s(39194),T=s(39303),E=s(31545),M=s(93784),P=s(9498),D=s(21355),_=s(6782);let F=e=>{var t,s;let{patient:r}=e,[n,i]=(0,l.useState)(null),[c,o]=(0,l.useState)(null),[d,m]=(0,l.useState)(!0);return((0,l.useEffect)(()=>{(async()=>{m(!0);let[e,t]=await Promise.all([k.lV(r.id),T.z0(r.id)]);i(e[0]||null),o(t||null),m(!1)})()},[r.id]),d)?(0,a.jsxs)("div",{className:"space-y-4 p-4",children:[(0,a.jsx)(_.E,{className:"h-24 w-full"}),(0,a.jsx)(_.E,{className:"h-32 w-full"})]}):(0,a.jsxs)("div",{className:"space-y-4 text-sm text-slate-300 p-4",children:[(0,a.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg flex items-center mb-2 text-slate-100",children:[(0,a.jsx)(E.A,{className:"w-5 h-5 mr-2 text-teal-400"}),"Paciente"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Queixa:"})," ",(null==(s=r.conditions)||null==(t=s[0])?void 0:t.name)||"N/A"]}),r.medicalAlerts&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-amber-500/20 text-amber-200 rounded flex items-start",children:[(0,a.jsx)(M.A,{className:"w-4 h-4 mr-2 mt-0.5 shrink-0"}),(0,a.jsx)("p",{className:"text-xs",children:r.medicalAlerts})]})]}),c&&(0,a.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,a.jsxs)("h3",{className:"font-bold flex items-center mb-2 text-slate-100",children:[(0,a.jsx)(P.A,{className:"w-5 h-5 mr-2 text-teal-400"}),"Objetivos"]}),(0,a.jsx)("p",{className:"text-xs",children:c.treatmentGoals})]}),n&&(0,a.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,a.jsxs)("h3",{className:"font-bold flex items-center mb-2 text-slate-100",children:[(0,a.jsx)(D.A,{className:"w-5 h-5 mr-2 text-teal-400"}),"\xdaltima Sess\xe3o (",n.date,")"]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"S:"})," ",n.subjective]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"A:"})," ",n.assessment]})]})]})]})};var O=s(42380),I=s(59435),R=s(50665);let Z=e=>{let{onShare:t}=e,{exercises:s,isLoading:r}=(0,O.F)(),[n,i]=(0,l.useState)(""),[c,o]=(0,l.useState)(null),d=(0,l.useMemo)(()=>n?s.filter(e=>e.name.toLowerCase().includes(n.toLowerCase())||e.category.toLowerCase().includes(n.toLowerCase())):s.slice(0,20),[s,n]);return(0,a.jsxs)("div",{className:"p-4 flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"relative mb-4",children:[(0,a.jsx)(I.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Buscar exerc\xedcio...",value:n,onChange:e=>i(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-slate-200"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto pr-2 -mr-2 space-y-2",children:r?(0,a.jsx)("p",{children:"Carregando..."}):d.map(e=>(0,a.jsxs)("div",{onClick:()=>o(e),className:"p-2 rounded-md cursor-pointer ".concat((null==c?void 0:c.id)===e.id?"bg-teal-500/20":"hover:bg-slate-700"),children:[(0,a.jsx)("p",{className:"font-semibold text-sm text-slate-200",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-slate-400",children:e.category})]},e.id))}),c&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[(0,a.jsx)("h4",{className:"font-bold text-slate-100",children:c.name}),(0,a.jsx)("p",{className:"text-xs text-slate-300 mt-1",children:c.description}),(0,a.jsxs)("button",{onClick:()=>t(c),className:"w-full mt-3 flex items-center justify-center bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg",children:[(0,a.jsx)(R.A,{className:"w-4 h-4 mr-2"})," Compartilhar com Paciente"]})]})]})},z=e=>{let{patient:t,onShare:s}=e;return(0,a.jsxs)("div",{className:"p-4 flex flex-col h-full",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-slate-100 mb-2",children:"Mapa de Dor"}),(0,a.jsx)("p",{className:"text-xs text-slate-400 mb-4",children:"Visualize o mapa de dor registrado pelo paciente. Voc\xea pode compartilhar esta tela para discutir em tempo real."}),(0,a.jsx)("div",{className:"flex-1 bg-slate-100 rounded-lg p-2",children:(0,a.jsx)(w.A,{points:t.painPoints||[],onMapClick:()=>{},onPointClick:()=>{}})}),(0,a.jsxs)("button",{onClick:()=>s(t.painPoints),className:"w-full mt-4 flex items-center justify-center bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg",children:[(0,a.jsx)(R.A,{className:"w-4 h-4 mr-2"})," Compartilhar Tela do Mapa"]})]})};var G=s(28647);let V=e=>{let{note:t,onNoteChange:s}=e,l=(e,a)=>{s({...t,[e]:a})};return(0,a.jsxs)("div",{className:"p-4 space-y-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold text-sky-400",children:"S (Subjetivo)"}),(0,a.jsx)(G.A,{value:t.subjective||"",onChange:e=>l("subjective",e),rows:3,placeholder:"Relato do paciente..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold text-sky-400",children:"O (Objetivo)"}),(0,a.jsx)(G.A,{value:t.objective||"",onChange:e=>l("objective",e),rows:3,placeholder:"Observa\xe7\xf5es da sess\xe3o..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold text-sky-400",children:"A (Avalia\xe7\xe3o)"}),(0,a.jsx)(G.A,{value:t.assessment||"",onChange:e=>l("assessment",e),rows:3,placeholder:"An\xe1lise da evolu\xe7\xe3o..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold text-sky-400",children:"P (Plano)"}),(0,a.jsx)(G.A,{value:t.plan||"",onChange:e=>l("plan",e),rows:3,placeholder:"Pr\xf3ximos passos..."})]})]})},B=e=>{let{icon:t,label:s,isActive:l,onClick:r}=e;return(0,a.jsxs)("button",{onClick:r,className:"flex-1 flex flex-col items-center justify-center p-3 text-xs font-medium border-b-2 transition-colors ".concat(l?"border-teal-400 text-teal-300 bg-slate-700/50":"border-transparent text-slate-400 hover:bg-slate-700"),title:s,children:[(0,a.jsx)(t,{className:"w-5 h-5 mb-1"}),(0,a.jsx)("span",{className:"truncate",children:s})]})},Y=e=>{let{patient:t,onShareContent:s,sessionNote:r,onNoteChange:n,isSaving:i}=e,[c,o]=(0,l.useState)("info");return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("nav",{className:"flex items-center border-b border-slate-700",children:[(0,a.jsx)(B,{icon:j.A,label:"Info Paciente",isActive:"info"===c,onClick:()=>o("info")}),(0,a.jsx)(B,{icon:C.A,label:"Exerc\xedcios",isActive:"exercises"===c,onClick:()=>o("exercises")}),(0,a.jsx)(B,{icon:S.A,label:"Mapa de Dor",isActive:"painMap"===c,onClick:()=>o("painMap")}),(0,a.jsx)(B,{icon:A.A,label:"Anota\xe7\xf5es",isActive:"notes"===c,onClick:()=>o("notes")})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["info"===c&&(0,a.jsx)(F,{patient:t}),"exercises"===c&&(0,a.jsx)(Z,{onShare:e=>{s({type:"exercise",data:e})}}),"painMap"===c&&(0,a.jsx)(z,{patient:t,onShare:e=>{s({type:"painMap",data:e})}}),"notes"===c&&(0,a.jsx)(V,{note:r,onNoteChange:n})]}),(0,a.jsx)("footer",{className:"p-2 border-t border-slate-700 bg-slate-900 text-center text-xs text-slate-400",children:i?"Salvando anota\xe7\xf5es...":(0,a.jsxs)("span",{className:"flex items-center justify-center text-green-400",children:[(0,a.jsx)(L.A,{size:12,className:"mr-1.5"})," Anota\xe7\xf5es salvas"]})})]})};var q=s(81882),W=s(85154);let X=()=>{let{appointmentId:e}=r.g(),t=r.Zp(),{showToast:s}=(0,f.dj)(),{appointments:c,patients:o,refetch:d}=(0,n.Ez)(),[m,u]=(0,l.useState)(null),[x,h]=(0,l.useState)(null),[j,v]=(0,l.useState)(null),[w,N]=(0,l.useState)(!0),[C,S]=(0,l.useState)(!0),[A,L]=(0,l.useState)(0),[T,E]=(0,l.useState)(!1),[M,P]=(0,l.useState)(null),[D,_]=(0,l.useState)({subjective:"",objective:"",assessment:"",plan:""}),[F,O]=(0,l.useState)(!1),I=(0,l.useRef)(null),R=(0,q.d)(D,2e3);(0,l.useEffect)(()=>{let t=c.find(t=>t.id===e);if(t){u(t);let e=o.find(e=>e.id===t.patientId);e&&h(e)}},[e,c,o]),(0,l.useEffect)(()=>{(async()=>{if(x&&m&&R&&!Object.values(R).every(e=>""===e||void 0===e)){O(!0);try{await k.Cq({...R,patientId:x.id,date:new Date().toLocaleDateString("pt-BR"),sessionNumber:m.sessionNumber}),s("Anota\xe7\xf5es salvas automaticamente.","info")}catch(e){s("Erro ao salvar anota\xe7\xf5es.","error")}finally{O(!1)}}})()},[R,x,m,s]);let Z=(0,l.useCallback)(()=>{j&&(j.getTracks().forEach(e=>e.stop()),v(null)),I.current&&clearInterval(I.current)},[j]);return((0,l.useEffect)(()=>{let e=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});v(e),I.current=window.setInterval(()=>L(e=>e+1),1e3)}catch(e){console.error("Error accessing media devices.",e),s("Permiss\xe3o para c\xe2mera/microfone negada.","error"),t("/agenda")}};return W.T.getSettings().teleconsultaEnabled?e():(s("O m\xf3dulo de Teleconsulta est\xe1 desativado.","error"),t("/agenda",{replace:!0})),Z},[t,s,Z]),m&&x)?(0,a.jsxs)("div",{className:"flex h-full bg-slate-900 text-white -m-8",children:[(0,a.jsxs)("main",{className:"flex-1 flex flex-col p-4 overflow-hidden",children:[(0,a.jsxs)("header",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h1",{className:"text-xl font-bold truncate",children:["Teleconsulta: ",x.name]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"bg-red-500/80 text-white px-3 py-1 rounded-md text-sm font-semibold flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full mr-2 animate-pulse"}),(0,a.jsx)("span",{children:"REC"}),(0,a.jsx)("span",{className:"ml-2 font-mono",children:(e=>{let t=Math.floor(e/60).toString().padStart(2,"0"),s=(e%60).toString().padStart(2,"0");return"".concat(t,":").concat(s)})(A)})]}),(0,a.jsx)("button",{onClick:()=>{document.fullscreenElement?document.exitFullscreen&&(document.exitFullscreen(),E(!1)):(document.documentElement.requestFullscreen(),E(!0))},className:"p-2 hover:bg-slate-700 rounded-full",children:T?(0,a.jsx)(b.A,{}):(0,a.jsx)(g.A,{})})]})]}),(0,a.jsx)(y,{patientStream:j,therapistStream:j,isTherapistCameraOn:C,sharedContent:M}),(0,a.jsx)("footer",{className:"mt-4",children:(0,a.jsx)(p,{isMicOn:w,isCameraOn:C,onToggleMic:()=>{null==j||j.getAudioTracks().forEach(e=>e.enabled=!w),N(!w)},onToggleCamera:()=>{null==j||j.getVideoTracks().forEach(e=>e.enabled=!C),S(!C)},onEndCall:()=>{Z(),t("/patients/".concat(null==x?void 0:x.id))}})})]}),(0,a.jsx)("aside",{className:"w-96 bg-slate-800 border-l border-slate-700 flex flex-col",children:(0,a.jsx)(Y,{patient:x,onShareContent:P,sessionNote:D,onNoteChange:_,isSaving:F})})]}):(0,a.jsx)(i.A,{})}},66822:(e,t,s)=>{"use strict";s.d(t,{dj:()=>n}),s(37876);var a=s(14232);let l=(0,a.createContext)(void 0),r=(0,a.createContext)(void 0),n=()=>{let e=(()=>{let e=(0,a.useContext)(l);return void 0===e?{enabled:!1,logRouterChange:()=>{},logHookCall:()=>{},logContextAccess:()=>{}}:e})(),t=(0,a.useContext)(r);if(e.logContextAccess("ToastContext","useToast"),!t){let e=Error("useToast must be used within a ToastProvider");throw console.error("âŒ Toast Context Error:",e.message),e}return{showToast:t.showToast}}},81882:(e,t,s)=>{"use strict";s.d(t,{d:()=>l});var a=s(14232);function l(e,t){let[s,l]=(0,a.useState)(e);return(0,a.useEffect)(()=>{let s=setTimeout(()=>{l(e)},t);return()=>{clearTimeout(s)}},[e,t]),s}},85154:(e,t,s)=>{"use strict";s.d(t,{T:()=>i});var a=s(14776);let l="fisioflow_scheduling_settings",r={limits:{weekday:[{id:"wd1",startTime:"07:00",endTime:"13:00",limit:3},{id:"wd2",startTime:"13:00",endTime:"15:00",limit:1},{id:"wd3",startTime:"15:00",endTime:"21:00",limit:4}],saturday:[{id:"sat1",startTime:"07:00",endTime:"13:00",limit:3}]},maxEvaluationsPerSlot:1,teleconsultaEnabled:!1};class n{getSettings(){try{let e=localStorage.getItem(l);if(e){let t=JSON.parse(e);return{...r,...t}}}catch(e){console.error("Failed to parse scheduling settings from localStorage",e)}return r}saveSettings(e){try{e.limits.weekday.sort((e,t)=>e.startTime.localeCompare(t.startTime)),e.limits.saturday.sort((e,t)=>e.startTime.localeCompare(t.startTime)),localStorage.setItem(l,JSON.stringify(e))}catch(e){console.error("Failed to save scheduling settings to localStorage",e)}}getSlotOccupancy(e,t,s){let l=this.getSettings(),r=e.getDay(),n=e.toTimeString().slice(0,5),i=(6===r?l.limits.saturday:l.limits.weekday).find(e=>n>=e.startTime&&n<e.endTime)||{limit:0},c=t.filter(t=>(!s||t.id!==s)&&t.startTime.getTime()===e.getTime()),o=c.filter(e=>e.type===a.YY.Evaluation),d=c.length>=i.limit,m=o.length>=l.maxEvaluationsPerSlot;return{patientCount:c.length,patientLimit:i.limit,evalCount:o.length,evalLimit:l.maxEvaluationsPerSlot,isFull:0===i.limit||d,isPatientLimitFull:0===i.limit||d,isEvalLimitFull:m}}}let i=new n},93704:(e,t,s)=>{"use strict";s.d(t,{cn:()=>r});var a=s(69241),l=s(29573);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,l.QP)((0,a.$)(t))}}},e=>{e.O(0,[3796,2749,5898,2170,8307,2317,6766,5977,1547,636,6593,8792],()=>e(e.s=37268)),_N_E=e.O()}]);