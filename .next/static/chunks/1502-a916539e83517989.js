"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1502],{748:(e,t,a)=>{a.d(t,{db:()=>d});var s=a(66766);let n=[...s.N],i=[...s.ZS],r=[...s.Tf],l=[...s.BT],o=[...s.eB],d={getPatients:()=>[...n],getPatientById:e=>n.find(t=>t.id===e),addPatient:e=>{n.unshift(e)},updatePatient:e=>{n=n.map(t=>t.id===e.id?e:t)},getAppointments:()=>[...i],saveAppointment:e=>{let t=i.findIndex(t=>t.id===e.id);t>-1?i[t]=e:i.push(e)},deleteAppointment:e=>{i=i.filter(t=>t.id!==e)},deleteAppointmentSeries:(e,t)=>{i=i.filter(a=>!(a.seriesId===e&&a.startTime>=t))},getSoapNotes:()=>[...r],saveSoapNote:e=>{let t=r.findIndex(t=>t.id===e.id);t>-1?r[t]=e:r.unshift(e)},getTreatmentPlans:()=>[...l],updateTreatmentPlan:e=>{let t=l.findIndex(t=>t.id===e.id);t>-1&&(l[t]=e)},getExercisePrescriptions:()=>[...o],setExercisePrescriptionsForPlan:(e,t)=>{(o=o.filter(t=>t.treatmentPlanId!==e)).push(...t)}}},12168:(e,t,a)=>{a.d(t,{L5:()=>c,OS:()=>d,Ob:()=>p,TC:()=>g,Xl:()=>x,Z6:()=>u,bW:()=>o,dc:()=>h,mQ:()=>m,uE:()=>l});var s=a(14776),n=a(748),i=a(87107);let r=e=>new Promise(t=>setTimeout(t,e)),l=async()=>(await r(500),[...n.db.getPatients()].sort((e,t)=>new Date(t.lastVisit).getTime()-new Date(e.lastVisit).getTime())),o=async e=>{if(await r(300),e.length<2)return[];let t=e.toLowerCase();return n.db.getPatients().filter(e=>e.name.toLowerCase().includes(t)||e.cpf.includes(t)).map(e=>({id:e.id,name:e.name,email:e.email,phone:e.phone,status:e.status,lastVisit:e.lastVisit,avatarUrl:e.avatarUrl,cpf:e.cpf})).slice(0,10)},d=async e=>{await r(500);let t={id:"patient_".concat(Date.now()),name:e.trim(),cpf:"TEMP-".concat(Date.now()),birthDate:"",phone:"",email:"",emergencyContact:{name:"",phone:""},address:{street:"",city:"",state:"",zip:""},status:s.WW.Active,lastVisit:new Date().toISOString(),registrationDate:new Date().toISOString(),avatarUrl:"https://picsum.photos/seed/".concat(Date.now(),"/200/200"),consentGiven:!0,whatsappConsent:"opt-out"};return n.db.addPatient(t),i.g.emit("patients:changed"),t},c=async e=>{let{limit:t=15,cursor:a,searchTerm:s,statusFilter:i,startDate:l,endDate:o,therapistId:d}=e;await r(500);let c=n.db.getPatients();if(s){let e=s.toLowerCase();c=c.filter(t=>t.name.toLowerCase().includes(e)||t.cpf.includes(e))}if(i&&"All"!==i){let e={Active:"Active",Inactive:"Inactive",Discharged:"Discharged",Ativo:"Active",Inativo:"Inactive",Alta:"Discharged"}[i]||i;c=c.filter(t=>t.status===e)}if(l){let e=new Date(l);e.setHours(0,0,0,0),c=c.filter(t=>new Date(t.registrationDate)>=e)}if(o){let e=new Date(o);e.setHours(23,59,59,999),c=c.filter(t=>new Date(t.registrationDate)<=e)}if(d&&"All"!==d){let e=new Set(n.db.getAppointments().filter(e=>e.therapistId===d).map(e=>e.patientId));c=c.filter(t=>e.has(t.id))}c.sort((e,t)=>{let a=new Date(e.registrationDate).getTime(),s=new Date(t.registrationDate).getTime();return s!==a?s-a:e.id.localeCompare(t.id)});let m=a?c.findIndex(e=>e.id===a)+1:0;if(a&&0===m)return{patients:[],nextCursor:null};let h=c.slice(m,m+t),u=h.length===t&&h.length>0?h[h.length-1].id:null;return{patients:h.map(e=>({id:e.id,name:e.name,email:e.email,phone:e.phone,status:e.status,lastVisit:e.lastVisit,avatarUrl:e.avatarUrl,medicalAlerts:e.medicalAlerts})),nextCursor:u}},m=async e=>(await r(300),n.db.getPatientById(e)),h=async e=>{await r(400);let t={id:"patient_".concat(Date.now()),...e,lastVisit:new Date().toISOString()};return n.db.addPatient(t),i.g.emit("patients:changed"),t},u=async e=>(await r(400),n.db.updatePatient(e),i.g.emit("patients:changed"),e),x=async(e,t)=>{await r(600);let a=n.db.getPatientById(e);if(!a)throw Error("Paciente n\xe3o encontrado.");let s={name:t.name,url:"#",type:t.type,size:t.size},l={...a,attachments:[...a.attachments||[],s]};return n.db.updatePatient(l),i.g.emit("patients:changed"),s},p=async(e,t)=>{await r(200);let a=n.db.getPatientById(e);if(!a)throw Error("Paciente n\xe3o encontrado.");let s={id:"log_".concat(Date.now()),...t},l={...a,communicationLogs:[s,...a.communicationLogs||[]]};return n.db.updatePatient(l),i.g.emit("patients:changed"),l},g=async(e,t)=>{await r(200);let a=n.db.getPatientById(e);if(!a)throw Error("Paciente n\xe3o encontrado.");let s={...a,painPoints:t};return n.db.updatePatient(s),i.g.emit("patients:changed"),s}},29121:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var s=a(37876),n=a(14232),i=a(34007),r=a(45907),l=a(4069),o=a(40570),d=a(25493),c=a(39493),m=a(3858),h=a(27217),u=a(97075),x=a(82470),p=a(88246),g=a(14776),f=a(60926),v=a(12168),w=a(88635),j=a(23118),b=a(35880);let y=e=>{let{title:t,value:a}=e;return(0,s.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-300",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-slate-500 truncate",children:t}),(0,s.jsx)("p",{className:"text-2xl font-bold text-slate-800 mt-1",children:a})]})};var N=a(28249),D=a(93536),A=a(6394),k=a(66822);let I=()=>({date:new Date,description:"",amount:0,category:g.Lc.Outros}),C=e=>{let{isOpen:t,onClose:a,onSave:i,onDelete:r,transactionToEdit:l}=e,[o,d]=(0,n.useState)(I()),[c,m]=(0,n.useState)(!1),{showToast:h}=(0,k.dj)();if((0,n.useEffect)(()=>{l?d({...l,date:new Date(l.date)}):d(I())},[l,t]),!t)return null;let u=e=>{let{name:t,value:a}=e.target,s="amount"===t?parseFloat(a):"date"===t?new Date(a):a;d(e=>({...e,[t]:s}))},x=async()=>{if(!o.description.trim()||o.amount<=0)return void h("Descri\xe7\xe3o e valor s\xe3o obrigat\xf3rios.","error");m(!0),await i({...o,...(null==l?void 0:l.id)&&{id:l.id}}),m(!1)},p=async()=>{l&&window.confirm("Tem certeza que deseja excluir esta despesa?")&&await r(l.id)},f=l?"Editar Despesa":"Nova Despesa",v=new Date(o.date.getTime()-6e4*o.date.getTimezoneOffset()).toISOString().split("T")[0];return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:a,children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("header",{className:"flex items-center justify-between p-5 border-b border-slate-200",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-slate-800",children:f}),(0,s.jsx)("button",{onClick:a,className:"p-2 rounded-full hover:bg-slate-100",children:(0,s.jsx)(N.A,{className:"w-5 h-5 text-slate-600"})})]}),(0,s.jsxs)("main",{className:"p-6 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Descri\xe7\xe3o*"}),(0,s.jsx)("input",{type:"text",name:"description",value:o.description,onChange:u,className:"mt-1 w-full p-2 border border-slate-300 rounded-lg"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Valor (R$)*"}),(0,s.jsx)("input",{type:"number",name:"amount",value:o.amount,onChange:u,className:"mt-1 w-full p-2 border border-slate-300 rounded-lg"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Data*"}),(0,s.jsx)("input",{type:"date",name:"date",value:v,onChange:u,className:"mt-1 w-full p-2 border border-slate-300 rounded-lg"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Categoria*"}),(0,s.jsx)("select",{name:"category",value:o.category,onChange:u,className:"mt-1 w-full p-2 border border-slate-300 rounded-lg bg-white",children:Object.values(g.Lc).map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]})]}),(0,s.jsxs)("footer",{className:"flex justify-between items-center p-4 border-t border-slate-200 bg-slate-50",children:[l?(0,s.jsxs)("button",{onClick:p,className:"px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg flex items-center",children:[(0,s.jsx)(D.A,{className:"w-4 h-4 mr-2"})," Excluir"]}):(0,s.jsx)("div",{}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 mr-2",children:"Cancelar"}),(0,s.jsxs)("button",{onClick:x,disabled:c,className:"px-4 py-2 text-sm font-medium text-white bg-teal-500 rounded-lg hover:bg-teal-600 flex items-center disabled:bg-teal-300",children:[(0,s.jsx)(A.A,{className:"w-4 h-4 mr-2"}),c?"Salvando...":"Salvar"]})]})]})]})})};var E=a(13991),P=a(49702);let S=e=>{let{transaction:t,onEdit:a}=e,n=t.type===g.D_.Receita,i=n?E.A:P.A;return(0,s.jsxs)("tr",{className:"border-b border-slate-200 hover:bg-slate-50",onClick:n?void 0:a,style:{cursor:n?"default":"pointer"},children:[(0,s.jsx)("td",{className:"p-3",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(i,{className:"w-5 h-5 mr-3 ".concat(n?"text-green-500":"text-red-500")}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-slate-800",children:t.description}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:t.patientName||t.category})]})]})}),(0,s.jsx)("td",{className:"p-3 text-sm text-slate-600",children:t.date.toLocaleDateString("pt-BR")}),(0,s.jsx)("td",{className:"p-3 text-sm text-slate-600 font-semibold text-right",children:(0,s.jsxs)("span",{className:n?"text-green-600":"text-red-600",children:[n?"+":"-"," R$ ",t.amount.toFixed(2).replace(".",",")]})})]})},T=e=>{let{transactions:t,onAddExpense:a,onEditExpense:n}=e;return(0,s.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-slate-800",children:"Lan\xe7amentos Recentes"}),(0,s.jsxs)("button",{onClick:a,className:"flex items-center bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm text-sm",children:[(0,s.jsx)(j.A,{size:18,className:"mr-2"})," Nova Despesa"]})]}),(0,s.jsx)("div",{className:"overflow-y-auto max-h-96",children:(0,s.jsxs)("table",{className:"min-w-full",children:[(0,s.jsx)("thead",{className:"bg-slate-50 sticky top-0",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Descri\xe7\xe3o"}),(0,s.jsx)("th",{className:"p-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Data"}),(0,s.jsx)("th",{className:"p-3 text-right text-xs font-medium text-slate-500 uppercase",children:"Valor"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-slate-200",children:t.length>0?t.map(e=>(0,s.jsx)(S,{transaction:e,onEdit:()=>n(e)},e.id)):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:3,className:"text-center p-10 text-slate-500",children:"Nenhum lan\xe7amento no per\xedodo."})})})]})})]})};var F=a(50033);let _=["#0088FE","#00C49F","#FFBB28","#FF8042","#AF19FF","#FF4560","#775DD0"],R=()=>{let[e,t]=(0,n.useState)("this_month"),{data:a,transactions:N,isLoading:D,refetch:A}=(e=>{let[t,a]=(0,n.useState)(null),[s,i]=(0,n.useState)([]),[r,l]=(0,n.useState)(!0),[o,d]=(0,n.useState)(null),c=(0,n.useCallback)(async()=>{l(!0);try{let[t,s]=await Promise.all([f.I0(e),v.uE()]);i(t);let n=t.filter(e=>e.type===g.D_.Receita),r=t.filter(e=>e.type===g.D_.Despesa),l=n.reduce((e,t)=>e+t.amount,0),o=r.reduce((e,t)=>e+t.amount,0),c=n.length>0?l/n.length:0,m=s.filter(e=>"Active"===e.status).length,h=new Map;t.forEach(e=>{let t=new Date(e.date).toLocaleDateString("pt-BR",{month:"short",day:"numeric"}),a=h.get(t)||{Receita:0,Despesa:0};e.type===g.D_.Receita?a.Receita+=e.amount:a.Despesa+=e.amount,h.set(t,a)});let u=Array.from(h.entries()).map(e=>{let[t,a]=e;return{date:t,...a}}).sort((e,t)=>{let[a,s]=e.date.split(" de "),[n,i]=t.date.split(" de "),r=["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],l=r.indexOf(s||""),o=r.indexOf(i||"");return l!==o?l-o:parseInt(a||"0")-parseInt(n||"0")}),x=new Map;n.forEach(e=>{let t=x.get(e.category)||0;x.set(e.category,t+e.amount)});let p=Array.from(x.entries()).map(e=>{let[t,a]=e;return{name:t,value:a}}),w=new Map;r.forEach(e=>{let t=w.get(e.category)||0;w.set(e.category,t+e.amount)});let j=Array.from(w.entries()).map(e=>{let[t,a]=e;return{name:t,value:a}});a({kpis:{grossRevenue:l,totalExpenses:o,netProfit:l-o,activePatients:m,averageTicket:c},cashFlowData:u,revenueBreakdown:p,expenseBreakdown:j}),d(null)}catch(e){d(e)}finally{l(!1)}},[e]);return(0,n.useEffect)(()=>{c()},[c]),{data:t,transactions:s,isLoading:r,error:o,refetch:c}})(e),[k,I]=(0,n.useState)(!1),[E,P]=(0,n.useState)(void 0),S=e=>"R$ ".concat(e.toFixed(2).replace(".",",")),R=e=>{P(e),I(!0)},B=()=>{P(void 0),I(!1)},O=async e=>{e.id?await f.eY(e):await f.k5(e),A(),B()},z=async e=>{await f.Wz(e),A(),B()};return D||!a?(0,s.jsx)(w.A,{}):(0,s.jsx)(F.Kl,{allowedRoles:[g.Xh.Admin,g.Xh.Therapist],children:(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)(b.A,{title:"Controle Financeiro",subtitle:"Vis\xe3o completa da sa\xfade financeira da sua cl\xednica.",children:(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-4 sm:mt-0",children:[(0,s.jsxs)("select",{value:e,onChange:e=>t(e.target.value),className:"rounded-lg border-slate-300 bg-white shadow-sm focus:ring-teal-500 focus:border-teal-500",children:[(0,s.jsx)("option",{value:"this_month",children:"Este M\xeas"}),(0,s.jsx)("option",{value:"last_3_months",children:"\xdaltimos 3 Meses"}),(0,s.jsx)("option",{value:"this_year",children:"Este Ano"})]}),(0,s.jsxs)("button",{onClick:()=>R(),className:"hidden sm:flex items-center bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-sm",children:[(0,s.jsx)(j.A,{size:20,className:"mr-2"})," Nova Despesa"]})]})}),(0,s.jsx)(C,{isOpen:k,onClose:B,onSave:O,onDelete:z,transactionToEdit:E}),(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-6",children:[(0,s.jsx)(y,{title:"Faturamento Bruto",value:S(a.kpis.grossRevenue)}),(0,s.jsx)(y,{title:"Despesas",value:S(a.kpis.totalExpenses)}),(0,s.jsx)(y,{title:"Lucro L\xedquido",value:S(a.kpis.netProfit)}),(0,s.jsx)(y,{title:"Pacientes Ativos",value:a.kpis.activePatients.toString()}),(0,s.jsx)(y,{title:"Ticket M\xe9dio",value:S(a.kpis.averageTicket)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-8",children:[(0,s.jsxs)("div",{className:"lg:col-span-3 bg-white p-6 rounded-2xl shadow-sm",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4 text-slate-800",children:"Fluxo de Caixa"}),(0,s.jsx)(i.u,{width:"100%",height:300,children:(0,s.jsxs)(r.b,{data:a.cashFlowData,children:[(0,s.jsx)(l.d,{strokeDasharray:"3 3"}),(0,s.jsx)(o.W,{dataKey:"date",fontSize:12}),(0,s.jsx)(d.h,{fontSize:12,tickFormatter:e=>"R$".concat(e/1e3,"k")}),(0,s.jsx)(c.m,{formatter:e=>S(e)}),(0,s.jsx)(m.s,{}),(0,s.jsx)(h.N,{type:"monotone",dataKey:"Receita",stroke:"#10b981",strokeWidth:2}),(0,s.jsx)(h.N,{type:"monotone",dataKey:"Despesa",stroke:"#f43f5e",strokeWidth:2})]})})]}),(0,s.jsxs)("div",{className:"lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4 text-slate-800",children:"Composi\xe7\xe3o das Despesas"}),(0,s.jsx)(i.u,{width:"100%",height:300,children:(0,s.jsxs)(u.r,{children:[(0,s.jsx)(x.F,{data:a.expenseBreakdown,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,fill:"#8884d8",paddingAngle:5,label:!0,children:a.expenseBreakdown.map((e,t)=>(0,s.jsx)(p.f,{fill:_[t%_.length]},"cell-".concat(t)))}),(0,s.jsx)(c.m,{formatter:e=>S(e)}),(0,s.jsx)(m.s,{})]})})]})]}),(0,s.jsx)(T,{transactions:N,onAddExpense:()=>R(),onEditExpense:R})]})})}},35880:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(37876);a(14232);let n=e=>{let{title:t,subtitle:a,children:n}=e;return(0,s.jsxs)("div",{className:"pb-8 md:flex md:items-center md:justify-between",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold leading-tight text-slate-900 tracking-tight",children:t}),(0,s.jsx)("p",{className:"mt-2 text-lg text-slate-600",children:a})]}),(0,s.jsx)("div",{className:"mt-4 flex md:mt-0 md:ml-4",children:n})]})}},50033:(e,t,a)=>{a.d(t,{Kl:()=>r});var s=a(37876);a(14232),a(14776);var n=a(45977),i=a(7108);let r=e=>{let{allowedRoles:t,children:a,fallback:r}=e,{user:l}=(0,n.W6)();return l&&t.includes(l.role)?(0,s.jsx)(s.Fragment,{children:a}):r||(0,s.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8",children:(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md text-center",children:[(0,s.jsx)(i.A,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Acesso Negado"}),(0,s.jsx)("p",{className:"text-red-600 mb-4",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta p\xe1gina."}),(0,s.jsxs)("div",{className:"text-sm text-red-500",children:[(0,s.jsxs)("p",{children:["Seu perfil: ",(0,s.jsx)("strong",{children:(null==l?void 0:l.role)||"N\xe3o identificado"})]}),(0,s.jsxs)("p",{children:["Perfis permitidos: ",(0,s.jsx)("strong",{children:t.join(", ")})]})]})]})})}},60926:(e,t,a)=>{a.d(t,{I0:()=>d,Wz:()=>h,YI:()=>u,eY:()=>m,k5:()=>c});var s=a(14776),n=a(66766);let i="fisioflow_expenses",r=e=>new Promise(t=>setTimeout(t,e)),l=()=>{try{let e=localStorage.getItem(i);if(e)return JSON.parse(e).map(e=>({...e,date:new Date(e.date)}))}catch(e){console.error("Failed to parse expenses from localStorage",e)}return o(n.UI),n.UI},o=e=>{try{localStorage.setItem(i,JSON.stringify(e))}catch(e){console.error("Failed to save expenses to localStorage",e)}},d=async e=>{let t;await r(200);let a=new Date;switch(e){case"this_month":t=new Date(a.getFullYear(),a.getMonth(),1);break;case"last_3_months":t=new Date(a.getFullYear(),a.getMonth()-2,1);break;case"this_year":t=new Date(a.getFullYear(),0,1)}return[...n.ZS.filter(e=>e.status===s.y2.Completed&&new Date(e.startTime)>=t).map(e=>({id:"rev_".concat(e.id),type:s.D_.Receita,date:e.startTime,description:"".concat(e.type," - ").concat(e.patientName),amount:e.value,category:e.type,patientName:e.patientName,appointmentId:e.id})),...l().filter(e=>new Date(e.date)>=t)].sort((e,t)=>t.date.getTime()-e.date.getTime())},c=async e=>{await r(300);let t=l(),a={...e,id:"exp_".concat(Date.now()),type:s.D_.Despesa};return t.unshift(a),o(t),a},m=async e=>{await r(300);let t=l();return o(t=t.map(t=>t.id===e.id?e:t)),e},h=async e=>{await r(300);let t=l();o(t=t.filter(t=>t.id!==e))},u=async e=>{await r(500);let t=n.XM,a=new Date,s=new Date(a.getFullYear(),a.getMonth(),1),i=[];for(let e of t)if(new Date(e.purchaseDate)>=s){let t=n.N.find(t=>t.id===e.patientId);if(t){let a=e.plan.price,s=.15*a,n=.05*a,r=a-s-n;i.push({id:"txn_".concat(e.id),type:"voucher_purchase",patientName:t.name,planName:e.plan.name,status:"completed",createdAt:e.purchaseDate,breakdown:{grossAmount:a,platformFee:s,taxAmount:n,netAmount:r}})}}return{summary:i.reduce((e,t)=>(e.grossRevenue+=t.breakdown.grossAmount,e.platformFee+=t.breakdown.platformFee,e.taxAmount+=t.breakdown.taxAmount,e.netRevenue+=t.breakdown.netAmount,e),{grossRevenue:0,platformFee:0,taxAmount:0,netRevenue:0,period:"Este M\xeas"}),transactions:t.map(e=>{let t=n.N.find(t=>t.id===e.patientId),a=e.plan.price,s=.15*a,i=.05*a;return{id:"txn_".concat(e.id),type:"voucher_purchase",patientName:(null==t?void 0:t.name)||"Desconhecido",planName:e.plan.name,status:"completed",createdAt:e.purchaseDate,breakdown:{grossAmount:a,platformFee:s,taxAmount:i,netAmount:a-s-i}}}).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}}},66822:(e,t,a)=>{a.d(t,{dj:()=>r}),a(37876);var s=a(14232);let n=(0,s.createContext)(void 0),i=(0,s.createContext)(void 0),r=()=>{let e=(()=>{let e=(0,s.useContext)(n);return void 0===e?{enabled:!1,logRouterChange:()=>{},logHookCall:()=>{},logContextAccess:()=>{}}:e})(),t=(0,s.useContext)(i);if(e.logContextAccess("ToastContext","useToast"),!t){let e=Error("useToast must be used within a ToastProvider");throw console.error("âŒ Toast Context Error:",e.message),e}return{showToast:t.showToast}}},87107:(e,t,a)=>{a.d(t,{g:()=>l});var s=a(14776),n=a(66766);let i=e=>new Promise(t=>setTimeout(t,e));class r{on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e!==t))}emit(e){for(var t=arguments.length,a=Array(t>1?t-1:0),s=1;s<t;s++)a[s-1]=arguments[s];this.events[e]&&this.events[e].forEach(e=>e(...a))}async getEvents(){return await i(300),[...this.eventsData].sort((e,t)=>t.startDate.getTime()-e.startDate.getTime())}async getEventById(e){await i(200);let t=this.eventsData.find(t=>t.id===e);return t?JSON.parse(JSON.stringify(t)):void 0}async getRegistrationsByEventId(e){return await i(200),this.registrationsData.filter(t=>t.eventId===e)}async saveEvent(e,t){if(await i(400),e.id){let t=this.eventsData.findIndex(t=>t.id===e.id);if(t>-1){let a=this.eventsData[t];if(!a)throw Error("Event not found");let s={...a,...e,id:a.id,registrations:a.registrations,providers:a.providers};return this.eventsData[t]=s,this.emit("events:changed"),s}throw Error("Event not found")}{let a={...e,id:"event_".concat(Date.now()),registrations:[],providers:[],organizerId:t};return this.eventsData.unshift(a),this.emit("events:changed"),a}}async checkInParticipant(e,t,a){await i(500);let n=this.registrationsData.findIndex(t=>t.id===e);if(-1===n)throw Error("Inscri\xe7\xe3o n\xe3o encontrada.");let r=this.registrationsData[n];if(!r)throw Error("Inscri\xe7\xe3o n\xe3o encontrada.");if(r.status===s.m7.Attended)throw Error("Participante j\xe1 fez check-in.");let l={...r,status:s.m7.Attended,checkedInAt:new Date,checkedInBy:a};this.registrationsData[n]=l;let o=this.eventsData.findIndex(e=>e.id===r.eventId);if(o>-1){let t=this.eventsData[o];if(t){let a=t.registrations.findIndex(t=>t.id===e);a>-1?t.registrations[a]=l:t.registrations.push(l)}}return this.emit("events:changed"),l}async confirmProvider(e){for(let t of(await i(500),this.eventsData)){let a=t.providers.findIndex(t=>t.id===e);if(a>-1){let e=t.providers[a];if(e){if(e.status!==s.aJ.Applied)throw Error("Apenas inscri\xe7\xf5es com status 'Inscrito' podem ser confirmadas.");return e.status=s.aJ.Confirmed,this.emit("events:changed"),e}}}throw Error("Prestador de servi\xe7o n\xe3o encontrado.")}async payProvider(e){for(let t of(await i(500),this.eventsData)){let a=t.providers.findIndex(t=>t.id===e);if(a>-1){let e=t.providers[a];if(e){if(e.status!==s.aJ.Confirmed)throw Error("Apenas prestadores confirmados podem receber pagamento.");return e.status=s.aJ.Paid,this.emit("events:changed"),e}}}throw Error("Prestador de servi\xe7o n\xe3o encontrado.")}constructor(){this.events={},this.eventsData=[...n._X],this.registrationsData=[...n.ZM]}}let l=new r},88635:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(37876);a(14232);var n=a(368);let i=()=>(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-slate-50",children:[(0,s.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,s.jsx)(n.A,{className:"w-16 h-16 text-teal-500 animate-pulse"}),(0,s.jsx)("div",{className:"absolute w-24 h-24 border-t-2 border-b-2 border-teal-200 rounded-full animate-spin"})]}),(0,s.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-600",children:"Carregando FisioFlow..."})]})}}]);