<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Supabase Auth</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #f5f5f5; }
        .console { background: #000; color: #0f0; padding: 20px; border-radius: 5px; margin: 20px 0; height: 400px; overflow-y: auto; }
        .error { color: #f00; }
        .warning { color: #fa0; }
        .info { color: #0af; }
        .success { color: #0f0; }
        button { padding: 10px 20px; margin: 10px; background: #007acc; color: white; border: none; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Supabase Authentication Test</h1>

    <button onclick="testSupabaseImport()">Test Supabase Import</button>
    <button onclick="testAuthService()">Test Auth Service</button>
    <button onclick="testMockLogin()">Test Mock Login</button>
    <button onclick="clearConsole()">Clear Console</button>

    <div id="console-output" class="console"></div>

    <script type="module">
        const consoleDiv = document.getElementById('console-output');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${timestamp}] ${message}`;
            consoleDiv.appendChild(div);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(`[${type}] ${message}`);
        }

        function clearConsole() {
            consoleDiv.innerHTML = '';
        }

        window.log = log;
        window.clearConsole = clearConsole;

        window.testSupabaseImport = async function() {
            log('Testing Supabase import...', 'info');
            try {
                const { supabase } = await import('/lib/supabase.ts');
                log('‚úÖ Supabase imported successfully', 'success');

                // Test basic connection
                const { data, error } = await supabase.auth.getSession();
                if (error) {
                    log(`‚ö†Ô∏è Supabase connection issue: ${error.message}`, 'warning');
                } else {
                    log('‚úÖ Supabase connection working', 'success');
                    log(`Session: ${data.session ? 'Active' : 'None'}`, 'info');
                }
            } catch (error) {
                log(`‚ùå Failed to import Supabase: ${error.message}`, 'error');
                log(`Error stack: ${error.stack}`, 'error');
            }
        };

        window.testAuthService = async function() {
            log('Testing Auth Service...', 'info');
            try {
                const authModule = await import('/services/auth/supabaseAuthService.ts');
                log('‚úÖ Auth service imported successfully', 'success');

                const authService = authModule.default;
                const state = authService.getState();
                log(`Auth state - Loading: ${state.loading}, User: ${state.user ? 'Yes' : 'No'}`, 'info');

            } catch (error) {
                log(`‚ùå Failed to import Auth Service: ${error.message}`, 'error');
                log(`Error stack: ${error.stack}`, 'error');
            }
        };

        window.testMockLogin = async function() {
            log('Testing mock login...', 'info');
            try {
                const authModule = await import('/services/auth/supabaseAuthService.ts');
                const authService = authModule.default;

                const credentials = {
                    email: 'admin@dudufisio.com',
                    password: 'demo123456'
                };

                log('Attempting mock login...', 'info');
                const user = await authService.login(credentials);
                log(`‚úÖ Mock login successful! User: ${user.name} (${user.role})`, 'success');

            } catch (error) {
                log(`‚ùå Mock login failed: ${error.message}`, 'error');
                log(`Error stack: ${error.stack}`, 'error');
            }
        };

        // Override console to capture all logs
        const originalConsole = window.console;
        window.console = {
            ...originalConsole,
            log: function(...args) {
                originalConsole.log(...args);
            },
            error: function(...args) {
                log(args.join(' '), 'error');
                originalConsole.error(...args);
            },
            warn: function(...args) {
                log(args.join(' '), 'warning');
                originalConsole.warn(...args);
            }
        };

        log('üîß Auth test page initialized', 'info');
        log('Click buttons above to test different components', 'info');
    </script>
</body>
</html>