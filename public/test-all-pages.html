<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test All Pages - DuduFisio AI</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .test-result { margin: 10px 0; padding: 15px; border-radius: 5px; border-left: 5px solid; }
        .success { background: #d4edda; border-color: #28a745; color: #155724; }
        .error { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        .loading { background: #fff3cd; border-color: #ffc107; color: #856404; }
        .info { background: #d1ecf1; border-color: #17a2b8; color: #0c5460; }
        .page-test { margin: 20px 0; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
        .page-header { background: #007acc; color: white; padding: 10px 15px; font-weight: bold; }
        .page-content { padding: 15px; }
        iframe { width: 100%; height: 400px; border: none; margin: 10px 0; border-radius: 5px; }
        button { padding: 8px 16px; margin: 5px; background: #007acc; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005999; }
        .stats { display: flex; gap: 20px; margin: 20px 0; }
        .stat { text-align: center; padding: 15px; background: white; border-radius: 8px; flex: 1; }
        .stat-number { font-size: 24px; font-weight: bold; color: #007acc; }
        .console { background: #000; color: #0f0; padding: 10px; border-radius: 5px; font-family: monospace; height: 200px; overflow-y: auto; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste Completo das P√°ginas - DuduFisio AI</h1>

        <div class="stats">
            <div class="stat">
                <div class="stat-number" id="total-tests">0</div>
                <div>Total de Testes</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="passed-tests">0</div>
                <div>Testes Aprovados</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="failed-tests">0</div>
                <div>Testes Falharam</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="success-rate">0%</div>
                <div>Taxa de Sucesso</div>
            </div>
        </div>

        <button onclick="runAllTests()">üöÄ Executar Todos os Testes</button>
        <button onclick="clearResults()">üßπ Limpar Resultados</button>
        <button onclick="testMainApp()">üéØ Testar App Principal</button>

        <div class="console" id="console"></div>

        <div id="test-results"></div>

        <div class="page-test">
            <div class="page-header">üì± Aplica√ß√£o Principal</div>
            <div class="page-content">
                <button onclick="loadMainApp()">Carregar App Principal</button>
                <iframe id="main-app" src="about:blank"></iframe>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];
        const console = document.getElementById('console');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.style.color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            div.textContent = `[${timestamp}] ${message}`;
            console.appendChild(div);
            console.scrollTop = console.scrollHeight;
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('console').innerHTML = '';
            testResults = [];
            updateStats();
        }

        function updateStats() {
            const total = testResults.length;
            const passed = testResults.filter(r => r.success).length;
            const failed = total - passed;
            const rate = total > 0 ? Math.round((passed / total) * 100) : 0;

            document.getElementById('total-tests').textContent = total;
            document.getElementById('passed-tests').textContent = passed;
            document.getElementById('failed-tests').textContent = failed;
            document.getElementById('success-rate').textContent = rate + '%';
        }

        function addTestResult(name, success, message) {
            testResults.push({ name, success, message });

            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `
                <strong>${success ? '‚úÖ' : '‚ùå'} ${name}</strong><br>
                ${message}
            `;

            document.getElementById('test-results').appendChild(resultDiv);
            updateStats();

            log(`${name}: ${success ? 'PASSED' : 'FAILED'} - ${message}`, success ? 'success' : 'error');
        }

        async function testUrl(name, url, timeout = 5000) {
            try {
                log(`Testing ${name}...`);

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), timeout);

                const response = await fetch(url, {
                    signal: controller.signal,
                    method: 'HEAD'
                });

                clearTimeout(timeoutId);

                if (response.ok) {
                    addTestResult(name, true, `HTTP ${response.status} - OK`);
                    return true;
                } else {
                    addTestResult(name, false, `HTTP ${response.status} - ${response.statusText}`);
                    return false;
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    addTestResult(name, false, `Timeout ap√≥s ${timeout}ms`);
                } else {
                    addTestResult(name, false, `Erro: ${error.message}`);
                }
                return false;
            }
        }

        async function testComponent(name, importPath) {
            try {
                log(`Testing component import: ${name}...`);
                const module = await import(importPath);
                addTestResult(`Component: ${name}`, true, `Importa√ß√£o bem-sucedida`);
                return true;
            } catch (error) {
                addTestResult(`Component: ${name}`, false, `Erro na importa√ß√£o: ${error.message}`);
                return false;
            }
        }

        async function testMainApp() {
            log('üéØ Testando aplica√ß√£o principal...');

            // Test main HTML
            await testUrl('P√°gina Principal (HTML)', 'http://localhost:5174/');

            // Test main JavaScript entry
            await testUrl('JavaScript Principal', 'http://localhost:5174/index.tsx');

            // Test App component
            await testComponent('App.tsx', '/App.tsx');

            // Test routing
            await testComponent('AppRoutes.tsx', '/AppRoutes.tsx');

            // Test authentication
            await testComponent('SupabaseAuthContext', '/contexts/SupabaseAuthContext.tsx');

            // Test core pages
            await testComponent('PatientListPage', '/pages/PatientListPage.tsx');
            await testComponent('AgendaPage', '/pages/AgendaPage.tsx');

            // Test dashboard components
            await testComponent('CompleteDashboard', '/pages/CompleteDashboard.tsx');
        }

        async function runAllTests() {
            clearResults();
            log('üöÄ Iniciando bateria completa de testes...');

            // Test core application
            await testMainApp();

            // Test static assets
            await testUrl('CSS Principal', 'http://localhost:5174/index.css');

            // Test development tools
            await testUrl('Vite Client', 'http://localhost:5174/@vite/client');

            // Test our debug pages
            await testUrl('Debug Page', 'http://localhost:5174/debug-app.html');
            await testUrl('Auth Test Page', 'http://localhost:5174/test-auth.html');

            log('‚úÖ Bateria de testes conclu√≠da!', 'success');
        }

        function loadMainApp() {
            log('üì± Carregando aplica√ß√£o principal no iframe...');
            const iframe = document.getElementById('main-app');
            iframe.src = 'http://localhost:5174/';

            iframe.onload = function() {
                log('‚úÖ App principal carregado no iframe', 'success');
            };

            iframe.onerror = function() {
                log('‚ùå Erro ao carregar app principal no iframe', 'error');
            };
        }

        // Auto-start basic tests
        log('üîß Sistema de testes inicializado');
        log('Clique em "Executar Todos os Testes" para come√ßar');

        // Quick connectivity test
        testUrl('Conectividade do Servidor', 'http://localhost:5174/', 2000);
    </script>
</body>
</html>